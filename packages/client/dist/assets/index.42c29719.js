var $e=Object.defineProperty;var qe=(i,s,e)=>s in i?$e(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e;var r=(i,s,e)=>(qe(i,typeof s!="symbol"?s+"":s,e),e);import{r as k,j as B,a as g,c as pe,F as Ze,g as Qe,b as et,d as ie,u as tt,e as st,f as it,l as ot,h as rt}from"./js/app-a49c935d.js";var u=(i=>(i.Yellow="YELLOW",i.Lime="LIME",i.Black="BLACK",i.Grey="#636363",i.LightGrey="LIGHTGREY",i.Orange="ORANGE",i.Red="RED",i.White="WHITE",i.Transparent="TRANSPARENT",i.LightCyan="LIGHTCYAN",i.Aqua="AQUA",i.Brown="BROWN",i.Green="GREEN",i.Blue="BLUE",i.AliceBlue="ALICEBLUE",i.Pink="#483D8B",i))(u||{});class A{constructor(){r(this,"listeners",{})}on(s,e){return this.listeners[s]||(this.listeners[s]=[]),this.listeners[s].push(e),this}emit(s,...e){var t;(t=this.listeners[s])==null||t.forEach(o=>{o.apply(this,e)})}off(s,e){var t;return this.listeners[s]=(t=this.listeners[s])==null?void 0:t.filter(o=>o!==e),this}offAll(s){return delete this.listeners[s],this}clearAllListeners(){Object.keys(this.listeners).forEach(s=>{delete this.listeners[s]})}}const Xe=i=>!!(i%2);function $(i,s){return Math.floor(Math.random()*(s-i+1))+i}async function at(i=100){return new Promise(s=>setTimeout(s,i))}var d=(i=>(i.Up="UP",i.Down="DOWN",i.Left="LEFT",i.Right="RIGHT",i))(d||{}),h=(i=>(i.Move="MOVE",i.Stop="STOP",i.Slide="SLIDE",i.Spawn="SPAWN",i.Despawn="DESPAWN",i.Ready="READY",i.Damaged="DAMAGED",i.Destroyed="DESTROYED",i.Exploding="EXPLODING",i.Shoot="SHOOT",i.SetLoopDelay="SET_LOOP_DELAY",i.SetLoopInterval="SET_LOOP_INTERVAL",i.ClearLoopInterval="CLEAR_LOOP_INTERVAL",i.WillHaveNewPos="ENTITY_WILL_HAVE_NEW_POS",i.WillDoDamage="ENTITY_WILL_DO_DAMAGE",i.ShouldBeDestroyed="ENTITY_SHOULD_BE_DESTROYED",i.ShouldUpdate="ENTITY_SHOULD_UPDATE",i.DidUpdate="ENTITY_DID_UPDATE",i.ShouldRenderText="ENTITY_SHOULD_RENDER_TEXT",i.AnimationStarted="ANIMATION_STARTED",i.AnimationEnded="ANIMATION_ENDED",i))(h||{});class X extends A{constructor(e){super();r(this,"posX",0);r(this,"posY",0);r(this,"width",0);r(this,"height",0);r(this,"direction",d.Up);r(this,"role","neutral");r(this,"type","custom");r(this,"spawned",!1);r(this,"alignedToGrid",!0);r(this,"movable",!1);r(this,"flying",!1);r(this,"crossable",!1);r(this,"hittable",!0);r(this,"color",u.Grey);r(this,"shouldBeDestroyed",!1);r(this,"damagedBy",null);r(this,"destroyedBy",null);r(this,"invincible",!1);r(this,"mainSpriteCoordinates",null);r(this,"mainSpriteFrame",0);r(this,"animationList",[]);r(this,"backImg",null);r(this,"backColor",null);Object.assign(this,e)}setState(e){this.emit(h.ShouldUpdate,e),Object.assign(this,e),this.emit(h.DidUpdate,e)}getRect(){return{posX:this.posX,posY:this.posY,width:this.width,height:this.height}}spawn(e){const{posX:t,posY:o}=e||{posX:this.posX,posY:this.posY},a={hasCollision:void 0,nextRect:{posX:t,posY:o,width:this.width,height:this.height}};return this.emit(h.WillHaveNewPos,a),a.hasCollision?this.type==="projectile"&&this.explode():(this.setState({posX:t,posY:o}),this.spawned=!0,this.emit(h.Spawn)),this.spawned}despawn(){!this.spawned||(this.shouldBeDestroyed=!0,this.emit(h.ShouldBeDestroyed),this.emit(h.Despawn),this.spawned=!1)}explode(){this.emit(h.Exploding),this.despawn()}beDestroyed(e){this.explode(),this.destroyedBy=e,this.emit(h.Destroyed,e)}takeDamage(e,t){this.type==="tank"&&this.damagedBy===e||(this.damagedBy=e,this.emit(h.Damaged,{...t,source:e}))}startAnimation(e){var t,o;(t=e.name)!=null||(e.name=Math.random().toString()),(o=e.spriteFrame)!=null||(e.spriteFrame=0),this.animationList.push(e),this.refreshSprite(),this.setLoopInterval(()=>{this.refreshSprite()},e.delay,e.name),this.emit(h.AnimationStarted,e.name),e.stopTimer&&this.setLoopDelay(this.cancelAnimation.bind(this,"showEntity",e.name),e.stopTimer)}cancelAnimation(e="eraseEntity",t){this.clearLoopInterval(t);const o=this.animationList.findIndex(a=>a.name===t);if(this.animationList.splice(o,1),this.emit(h.AnimationEnded,t),e==="showEntity"){this.refreshSprite();return}e==="eraseEntity"&&this.emit(h.ShouldUpdate)}refreshSprite(){this.emit(h.ShouldUpdate),this.emit(h.DidUpdate)}setLoopInterval(e,t,o){this.emit(h.SetLoopInterval,e,t,o)}clearLoopInterval(e){this.emit(h.ClearLoopInterval,e)}setLoopDelay(e,t){this.emit(h.SetLoopDelay,e,t)}}class fe extends X{constructor(e){super(e);r(this,"moving",!1);r(this,"stopping",!1);r(this,"canMove",!0);r(this,"lastRect",null);r(this,"nextRect",null);r(this,"movePace",2);r(this,"moveSpeed",3);r(this,"moveStepsProgress",0);r(this,"moveStepsTotal",12);r(this,"nextDirection",d.Up);r(this,"moveLoops",0);r(this,"frozen",!1);this.movable=!0}getMoveSteps(){return this.moveStepsTotal-this.moveSpeed}getMoveStepPace(){return this.movePace/this.getMoveSteps()}move(e){this.moving=!0,this.nextDirection=e,this.spawned&&!this.frozen&&this.emit(h.Move)}stop(){this.moving=!1,this.moveStepsProgress&&(this.stopping=!0),this.emit(h.Stop)}turn(e=this.nextDirection){this.direction!==e&&(this.emit(h.Stop),this.moving&&this.emit(h.Move),this.setState({direction:e}),this.moveLoops=0)}update(){if(!this.spawned||this.frozen||(this.stateCheck(),this.shouldBeDestroyed)||!this.moving&&!this.stopping&&!this.shouldBeDestroyed)return;if(this.moveStepsProgress!==0){this.moveStep();return}const o=this.stopping?!1:this.direction!==this.nextDirection,a=this.moveLoops>this.getMoveSteps();o?a?this.turn():this.turnWithInterrupt():(this.prepareToMove(),this.moveStep())}turnWithInterrupt(){this.turn(),++this.moveStepsProgress,this.canMove=!1}prepareToMove(){this.lastRect=this.getRect();const e={...this.lastRect,...this.getNextMove(!0)},t={hasCollision:void 0,nextRect:e};this.emit(h.WillHaveNewPos,t),t.hasCollision?(this.canMove=!1,this.nextRect=null):(this.canMove=!0,this.nextRect=e)}getNextMove(e=!1){let t=0;switch(e?t=this.movePace:t=this.getMoveStepPace(),this.direction){case d.Up:return{posY:this.posY-t};case d.Down:return{posY:this.posY+t};case d.Left:return{posX:this.posX-t};case d.Right:return{posX:this.posX+t}}}moveStep(){++this.moveStepsProgress>=this.getMoveSteps()?(this.moveStepsProgress=0,this.alignedToGrid=!0,this.stopping=!1,this.canMove&&this.nextRect&&(this.setState(this.nextRect),++this.moveLoops)):(this.alignedToGrid=!1,this.canMove?(this.setState(this.getNextMove()),++this.moveLoops):this.refreshSprite())}}const nt="\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 \u0434\u043B\u044F \u0438\u0433\u0440\u044B \u0432 \u0442\u0435\u0447\u0435\u043D\u0438\u0435 \u043C\u0438\u043D\u0443\u0442\u044B. \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043E\u0442\u043C\u0435\u043D\u0435\u043D\u0430. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443.",lt="\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 \u0434\u043B\u044F \u0438\u0433\u0440\u044B. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443.";var U=(i=>(i.BrickBgClassic="BRICK_BG_CLASSIC",i.BrickBgModern="BRICK_BG_MODERN",i.ClassicDesignSprite="CLASSIC_DESIGN_SPRITE",i.ModernDesignSprite="MODERN_DESIGN_SPRITE",i.Tarmac="TARMAC",i))(U||{});const We={BRICK_BG_CLASSIC:"/assets/img/bricks.png",BRICK_BG_MODERN:"/assets/img/bricks_modern.png",CLASSIC_DESIGN_SPRITE:"/assets/img/sprite.png",MODERN_DESIGN_SPRITE:"/assets/img/sprite_modern.png",TARMAC:"/assets/img/tarmac_background.png"};var ye=(i=>(i.levelIntro="/assets/sounds/level-intro.mp3",i.gameOver="/assets/sounds/game-over.mp3",i.pause="/assets/sounds/pause.mp3",i.move="/assets/sounds/tank-move.mp3",i.idle="/assets/sounds/tank-idle.mp3",i.ice="/assets/sounds/ice.mp3",i.shoot="/assets/sounds/shoot.mp3",i.hitEnemy="/assets/sounds/hit-enemy.mp3",i.hitBrick="/assets/sounds/hit-brick.mp3",i.hitSteel="/assets/sounds/hit-steel.mp3",i.playerExplosion="/assets/sounds/player-explosion.mp3",i.enemyExplosion="/assets/sounds/enemy-explosion.mp3",i.powerupAppear="/assets/sounds/powerup-appear.mp3",i.powerupPickup="/assets/sounds/powerup-pickup.mp3",i.lifePickup="/assets/sounds/life.mp3",i.score="/assets/sounds/score.mp3",i.score2="/assets/sounds/score.mp3",i))(ye||{});const ht={...We,...ye},Le={images:["png","svg","jpg","jpeg","gif"],sounds:["mp3"]};var q=(i=>(i.Loaded="LOADED",i.Error="ERROR",i))(q||{}),O=(i=>(i.ToggleVisibilityServiceBtn="TOGGLE_VISIBILITY_SERVICE_BUTTONS",i.ToggleColorServiceBtn="TOGGLE_COLOR_SERVICE_BUTTONS",i))(O||{}),G=(i=>(i.Classic="CLASSIC",i.Modern="MODERN",i))(G||{});const ve="GameDesignName",H={CLASSIC:{spriteName:U.ClassicDesignSprite,menuTitle:"1990",floorBg:'url("")'+u.Black,brickBg:U.BrickBgClassic},MODERN:{spriteName:U.ModernDesignSprite,menuTitle:"2023",floorBg:`url(${We[U.Tarmac]}) center/15%`,brickBg:U.BrickBgModern}},oe={[G.Classic]:{flag:[[1532,736,64,60]],"base.heart.alive":[[1244,128,64,64]],"base.heart.dead":[[1308,128,64,64]],"terrain.trees":[[1117,128,63,63]],"terrain.ice":[[1180,128,63,63]],"terrain.concrete":{WHOLE:[[1052,64,64,64]],TOP:[[1052,64,64,32]],BOTTOM:[[1052,64,64,32]],LEFT:[[1052,64,32,64]],RIGHT:[[1052,64,32,64]],LEFT_BOTTOM:[[1052,64,32,32]],RIGHT_BOTTOM:[[1052,64,32,32]]},"terrain.brick":{WHOLE:[[1052,0,64,64]],TOP:[[1052,0,64,32]],BOTTOM:[[1052,0,64,32]],LEFT:[[1052,0,32,64]],RIGHT:[[1052,0,32,64]],LEFT_BOTTOM:[[1052,0,32,32]],RIGHT_BOTTOM:[[1052,0,32,32]]},"terrain.water":[[1117,192,63,63],[1053,192,63,63]],"terrain.menu-brick":[[0,0,16,16],[16,0,16,16]],"terrain.inverse-brick":[[0,0,16,16],[16,0,16,16]],"terrain.blue-brick":[[0,0,16,16],[16,0,16,16]],projectile:{UP:[[1312,405,28,28],[1312,405,28,28]],RIGHT:[[1407,400,28,28],[1407,400,28,28]],DOWN:[[1377,405,28,28],[1377,405,28,28]],LEFT:[[1342,400,28,28],[1342,400,28,28]]},projectileExplosion:[[1052,512,64,64],[1116,512,64,64],[1180,512,64,64]],tankExplosion:[[1244,512,128,128],[1372,512,128,128],[1244,512,128,128],[1372,512,128,128]],shield:[[1052,576,64,64],[1116,576,64,64]],spawn:[[1050,380,65,65],[1116,380,65,65],[1180,380,65,65],[1244,380,65,65]],"tank.enemy.default.a":{UP:[[524,264,52,60],[588,264,52,60]],DOWN:[[780,264,52,60],[844,264,52,60]],LEFT:[[648,272,60,52],[712,272,60,52]],RIGHT:[[908,268,60,52],[972,268,60,52]]},"tank.enemy.default.b":{UP:[[524,328,52,60],[588,328,52,60]],DOWN:[[780,332,52,60],[844,332,52,60]],LEFT:[[648,336,60,52],[712,336,60,52]],RIGHT:[[908,332,60,52],[972,332,60,52]]},"tank.enemy.default.c":{UP:[[524,396,52,60],[588,396,52,60]],DOWN:[[776,396,52,60],[840,396,52,60]],LEFT:[[648,404,60,52],[712,404,60,52]],RIGHT:[[908,400,60,52],[972,400,60,52]]},"tank.enemy.default.d":{UP:[[524,460,52,60],[588,460,52,60]],DOWN:[[780,460,52,60],[844,460,52,60]],LEFT:[[648,464,60,52],[712,464,60,52]],RIGHT:[[904,464,60,52],[968,464,60,52]]},"tank.enemy.danger.a":{UP:[[524,788,52,60],[588,788,52,60]],DOWN:[[780,788,52,60],[844,788,52,60]],LEFT:[[648,796,60,52],[712,796,60,52]],RIGHT:[[908,792,60,52],[972,792,60,52]]},"tank.enemy.danger.b":{UP:[[524,852,52,60],[588,852,52,60]],DOWN:[[780,856,52,60],[844,856,52,60]],LEFT:[[648,860,60,52],[712,860,60,52]],RIGHT:[[908,856,60,52],[972,856,60,52]]},"tank.enemy.danger.c":{UP:[[524,920,52,60],[588,920,52,60]],DOWN:[[776,920,52,60],[840,920,52,60]],LEFT:[[648,928,60,52],[712,928,60,52]],RIGHT:[[908,924,60,52],[972,924,60,52]]},"tank.enemy.danger.d":{UP:[[524,984,52,60],[588,984,52,60]],DOWN:[[780,984,52,60],[844,984,52,60]],LEFT:[[648,988,60,52],[712,988,60,52]],RIGHT:[[904,988,60,52],[968,988,60,52]]},"tank.enemy.primary.d":{UP:[[4,460,52,60],[68,460,52,60]],DOWN:[[264,460,52,60],[328,460,52,60]],LEFT:[[128,464,60,52],[196,464,60,52]],RIGHT:[[388,464,60,52],[456,464,60,52]]},"tank.enemy.secondary.d":{UP:[[4,984,52,60],[68,984,52,60]],DOWN:[[264,984,52,60],[328,984,52,60]],LEFT:[[128,988,60,52],[196,988,60,52]],RIGHT:[[388,988,60,52],[456,988,60,52]]},"tank.player.primary.a":{UP:[[4,8,52,52],[68,8,52,52]],DOWN:[[264,4,52,52],[328,4,52,52]],LEFT:[[136,4,52,52],[204,4,52,52]],RIGHT:[[392,4,52,52],[460,4,52,52]]},"tank.player.primary.b":{UP:[[4,64,52,64],[68,64,52,64]],DOWN:[[264,64,52,64],[328,64,52,64]],LEFT:[[128,68,64,52],[196,68,64,52]],RIGHT:[[388,68,64,52],[456,68,64,52]]},"tank.player.primary.c":{UP:[[4,132,52,60],[68,132,52,60]],DOWN:[[264,136,52,60],[328,136,52,60]],LEFT:[[128,136,60,52],[196,136,60,52]],RIGHT:[[392,136,60,52],[460,136,60,52]]},"tank.player.primary.d":{UP:[[4,200,56,60],[68,200,56,60]],DOWN:[[264,200,56,60],[328,200,56,60]],LEFT:[[128,204,60,56],[196,204,60,56]],RIGHT:[[392,204,60,56],[460,204,60,56]]},"tank.player.secondary.a":{UP:[[4,532,52,52],[68,532,52,52]],DOWN:[[264,528,52,52],[328,528,52,52]],LEFT:[[136,528,52,52],[204,528,52,52]],RIGHT:[[392,528,52,52],[460,528,52,52]]},"tank.player.secondary.b":{UP:[[4,588,52,64],[68,588,52,64]],DOWN:[[264,588,52,64],[328,588,52,64]],LEFT:[[128,592,64,52],[196,592,64,52]],RIGHT:[[388,592,64,52],[456,592,64,52]]},"tank.player.secondary.c":{UP:[[4,656,52,60],[68,656,52,60]],DOWN:[[264,660,52,60],[328,660,52,60]],LEFT:[[128,660,60,52],[196,660,60,52]],RIGHT:[[392,660,60,52],[460,660,60,52]]},"tank.player.secondary.d":{UP:[[4,724,56,60],[68,724,56,60]],DOWN:[[264,724,56,60],[328,724,56,60]],LEFT:[[128,728,60,56],[196,728,60,56]],RIGHT:[[392,728,60,56],[460,728,60,56]]},"powerup.helmet":[[1052,448,64,60],[0,0,1,1]],"powerup.clock":[[1116,448,64,60],[0,0,1,1]],"powerup.shovel":[[1180,448,64,60],[0,0,1,1]],"powerup.star":[[1244,448,64,60],[0,0,1,1]],"powerup.grenade":[[1308,448,64,60],[0,0,1,1]],"powerup.tank":[[1372,448,64,60],[0,0,1,1]],"powerup.gun":[[1436,448,64,60],[0,0,1,1]],"points.100":[[1180,640,64,64]],"points.200":[[1244,640,64,64]],"points.300":[[1308,640,64,64]],"points.400":[[1372,640,64,64]],"points.500":[[1436,640,64,64]],"ui.enemy":[[1308,768,32,32]],"ui.player":[[1536,576,28,32]],"ui.pause":[[1184,704,156,28]],"ui.gameOver":[[1184,736,124,60]]},[G.Modern]:{flag:[[1532,736,64,60]],"base.heart.alive":[[1248,132,55,55]],"base.heart.dead":[[1308,128,64,64]],"terrain.trees":[[1122,128,51,52]],"terrain.ice":[[1398,128,72,72]],"terrain.concrete":{WHOLE:[[1060,71,50,50]],TOP:[[1060,71,50,25]],BOTTOM:[[1060,71,50,25]],LEFT:[[1060,71,25,50]],RIGHT:[[1060,71,25,50]],LEFT_BOTTOM:[[1060,71,25,25]],RIGHT_BOTTOM:[[1060,71,25,25]]},"terrain.brick":{WHOLE:[[1052,0,64,64]],TOP:[[1052,0,64,32]],BOTTOM:[[1052,0,64,32]],LEFT:[[1052,0,32,64]],RIGHT:[[1052,0,32,64]],LEFT_BOTTOM:[[1052,0,32,32]],RIGHT_BOTTOM:[[1052,0,32,32]]},"terrain.water":[[1086,192,74,74],[1161,192,74,74]],"terrain.menu-brick":[[0,0,16,16],[16,0,16,16]],"terrain.inverse-brick":[[0,0,16,16],[16,0,16,16]],"terrain.blue-brick":[[0,0,16,16],[16,0,16,16]],projectile:{UP:[[1345,346,50,52],[1345,346,50,52]],RIGHT:[[1395,358,52,50],[1395,358,52,45]],DOWN:[[1309,348,50,52],[1309,348,50,52]],LEFT:[[1395,319,52,50],[1395,319,52,50]]},projectileExplosion:[[1293,810,104,104],[1406,830,84,84],[1406,830,50,50]],tankExplosion:[[1323,830,64,64],[1416,830,64,64],[1416,830,64,64]],shield:[[1052,576,64,64],[1116,576,64,64]],spawn:[[1050,380,65,65],[1116,380,65,65],[1180,380,65,65],[1244,380,65,65]],"tank.enemy.default.a":{UP:[[-4,623,67,62],[60,623,67,62]],DOWN:[[279,621,67,62],[343,621,67,62]],LEFT:[[134,623,62,67],[211,623,62,67]],RIGHT:[[415,623,62,67],[492,623,62,67]]},"tank.enemy.default.b":{UP:[[-4,702,67,62],[60,702,67,62]],DOWN:[[278,702,67,62],[342,702,67,62]],LEFT:[[134,702,62,67],[211,702,62,67]],RIGHT:[[415,702,62,67],[492,702,62,67]]},"tank.enemy.default.c":{UP:[[1,781,60,60],[65,781,60,60]],DOWN:[[284,781,60,60],[348,781,60,60]],LEFT:[[135,781,60,60],[212,781,60,60]],RIGHT:[[416,781,60,60],[493,781,60,60]]},"tank.enemy.default.d":{UP:[[1,859,60,60],[65,859,60,60]],DOWN:[[284,859,60,60],[348,859,60,60]],LEFT:[[135,859,60,60],[212,859,60,60]],RIGHT:[[416,859,60,60],[493,859,60,60]]},"tank.enemy.danger.a":{UP:[[-4,935,67,62],[60,935,67,62]],DOWN:[[279,933,67,62],[343,933,67,62]],LEFT:[[134,935,62,67],[211,935,62,67]],RIGHT:[[415,935,62,67],[492,935,62,67]]},"tank.enemy.danger.b":{UP:[[-4,1014,67,62],[60,1014,67,62]],DOWN:[[278,1014,67,62],[342,1014,67,62]],LEFT:[[134,1014,62,67],[211,1014,62,67]],RIGHT:[[415,1014,62,67],[492,1014,62,67]]},"tank.enemy.danger.c":{UP:[[1,1093,60,60],[65,1093,60,60]],DOWN:[[284,1093,60,60],[348,1093,60,60]],LEFT:[[135,1093,60,60],[212,1093,60,60]],RIGHT:[[416,1093,60,60],[493,1093,60,60]]},"tank.enemy.danger.d":{UP:[[1,1171,60,60],[65,1171,60,60]],DOWN:[[284,1171,60,60],[348,1171,60,60]],LEFT:[[135,1171,60,60],[212,1171,60,60]],RIGHT:[[416,1171,60,60],[493,1171,60,60]]},"tank.enemy.primary.d":{UP:[[1,549,60,60],[65,549,60,60]],DOWN:[[284,549,60,60],[348,549,60,60]],LEFT:[[135,549,60,60],[212,549,60,60]],RIGHT:[[416,549,60,60],[493,549,60,60]]},"tank.enemy.secondary.d":{UP:[[1,240,60,60],[65,240,60,60]],DOWN:[[284,240,60,60],[348,240,60,60]],LEFT:[[135,240,60,60],[212,240,60,60]],RIGHT:[[416,240,60,60],[493,240,60,60]]},"tank.player.primary.a":{UP:[[-4,2,67,62],[60,2,67,62]],DOWN:[[279,0,67,62],[343,0,67,62]],LEFT:[[134,2,62,67],[211,2,62,67]],RIGHT:[[415,2,62,67],[492,2,62,67]]},"tank.player.primary.b":{UP:[[-4,80,67,62],[60,80,67,62]],DOWN:[[278,77,67,62],[342,77,67,62]],LEFT:[[134,77,62,67],[211,77,62,67]],RIGHT:[[415,77,62,67],[492,77,62,67]]},"tank.player.primary.c":{UP:[[1,162,60,60],[65,162,60,60]],DOWN:[[284,162,60,60],[348,162,60,60]],LEFT:[[135,162,60,60],[212,162,60,60]],RIGHT:[[416,162,60,60],[493,162,60,60]]},"tank.player.primary.d":{UP:[[1,240,60,60],[65,240,60,60]],DOWN:[[284,240,60,60],[348,240,60,60]],LEFT:[[135,240,60,60],[212,240,60,60]],RIGHT:[[416,240,60,60],[493,240,60,60]]},"tank.player.secondary.a":{UP:[[-4,314,67,62],[60,314,67,62]],DOWN:[[279,312,67,62],[343,312,67,62]],LEFT:[[134,314,62,67],[211,314,62,67]],RIGHT:[[415,314,62,67],[492,314,62,67]]},"tank.player.secondary.b":{UP:[[-4,392,67,62],[60,392,67,62]],DOWN:[[278,392,67,62],[342,392,67,62]],LEFT:[[134,392,62,67],[211,392,62,67]],RIGHT:[[415,392,62,67],[492,392,62,67]]},"tank.player.secondary.c":{UP:[[1,472,60,60],[65,472,60,60]],DOWN:[[284,472,60,60],[348,472,60,60]],LEFT:[[135,472,60,60],[212,472,60,60]],RIGHT:[[416,472,60,60],[493,472,60,60]]},"tank.player.secondary.d":{UP:[[1,548,60,60],[65,548,60,60]],DOWN:[[284,548,60,60],[348,548,60,60]],LEFT:[[135,548,60,60],[212,548,60,60]],RIGHT:[[416,548,60,60],[493,548,60,60]]},"powerup.helmet":[[1052,448,64,60]],"powerup.clock":[[1116,448,64,60]],"powerup.shovel":[[1180,448,64,60]],"powerup.star":[[1244,448,64,60]],"powerup.grenade":[[1308,448,64,60]],"powerup.tank":[[1372,448,64,60]],"powerup.gun":[[1436,448,64,60]],"points.100":[[1180,640,64,64]],"points.200":[[1244,640,64,64]],"points.300":[[1308,640,64,64]],"points.400":[[1372,640,64,64]],"points.500":[[1436,640,64,64]],"ui.enemy":[[1308,768,32,32]],"ui.player":[[1536,576,28,32]],"ui.pause":[[1184,704,156,28]],"ui.gameOver":[[1184,736,124,60]]}};let p=oe[G.Classic];var Ge;if(typeof localStorage<"u"){const i=(Ge=localStorage.getItem(ve))!=null?Ge:G.Classic;i in oe&&(p=oe[i])}function ct(i){p=oe[i]}class Ue extends X{constructor(e){super({posX:0,posY:0});r(this,"variant","PROJECTILE_EXPLOSION");r(this,"parent");r(this,"despawnTime",200);this.type="explosion",this.crossable=!0,this.hittable=!1,this.color=u.Transparent,this.parent=e.parent,Object.assign(this,this.calculateProps(e));let t=0;switch(this.variant){case"PROJECTILE_EXPLOSION":this.mainSpriteCoordinates=p.projectileExplosion;break;case"TANK_EXPLOSION":this.mainSpriteCoordinates=p.tankExplosion,t=16;break}this.registerExplosionEvents({animationDelay:t})}registerExplosionEvents({animationDelay:e}){this.on(h.Spawn,()=>{this.startAnimation({delay:e,spriteCoordinates:this.mainSpriteCoordinates,looped:!1}),this.on(h.AnimationEnded,this.despawn.bind(this)),this.setLoopDelay(this.despawn.bind(this),this.despawnTime)})}calculateProps({parent:e}){const t=e.type==="projectile"?4:8,o=e.type==="projectile"?"PROJECTILE_EXPLOSION":"TANK_EXPLOSION";let a=e.posX,n=e.posY;const l=e.direction===d.Up||e.direction===d.Left?-2:0;return e.direction===d.Up||e.direction===d.Down?e.type==="tank"?(e.direction===d.Up&&(a+=l,n+=l-2),e.direction===d.Down&&(a+=l-2,n+=l-2)):(a-=1,n+=l):e.type==="tank"?(e.direction===d.Right&&(a+=l,n+=l-2),e.direction===d.Left&&(a+=l,n+=l)):(a+=l,n-=1),{variant:o,posX:a,posY:n,width:t,height:t}}}class ut extends X{constructor(e){super(e);r(this,"destroyed",!1);Object.assign(this,e),this.type="flag",this.color=u.White,this.crossable=!1,this.hittable=!0,this.mainSpriteCoordinates=p["base.heart.alive"],this.registerFlagEvents()}registerFlagEvents(){this.on(h.Damaged,({source:e})=>{this.destroyed||(this.mainSpriteCoordinates=p["base.heart.dead"],this.refreshSprite(),this.emit(h.Destroyed,e),this.destroyed=!0)})}}const ke=["STAR","TANK","HELMET","GRENADE","SHOVEL","CLOCK"];class re extends X{constructor(){super({posX:0,posY:0});r(this,"width",4);r(this,"height",4);r(this,"variant","STAR");switch(this.type="powerup",this.variant=this.getRandomVariant(),this.crossable=!0,this.hittable=!1,this.color="transparent",this.variant){case"STAR":this.mainSpriteCoordinates=p["powerup.star"];break;case"TANK":this.mainSpriteCoordinates=p["powerup.tank"];break;case"HELMET":this.mainSpriteCoordinates=p["powerup.helmet"];break;case"GRENADE":this.mainSpriteCoordinates=p["powerup.grenade"];break;case"SHOVEL":this.mainSpriteCoordinates=p["powerup.shovel"];break;case"CLOCK":this.mainSpriteCoordinates=p["powerup.clock"];break}this.registerPowerupEvents()}getRandomVariant(){return ke[Math.floor(Math.random()*ke.length)]}registerPowerupEvents(){this.on(h.Spawn,()=>{this.startAnimation({delay:200,spriteCoordinates:this.mainSpriteCoordinates,looped:!0})}),this.on(h.Damaged,({source:e})=>{this.beDestroyed(e)})}}class V extends fe{constructor(e){super(e);r(this,"width",2);r(this,"height",2);r(this,"movePace",2);r(this,"moveSpeed",1);r(this,"moveSpeedPrev",1);r(this,"moveStepsTotal",5);r(this,"explosionRadius",1);r(this,"explosionForce",1);r(this,"parent",null);Object.assign(this,e),this.type="projectile",this.color=u.Red,this.mainSpriteCoordinates=p.projectile,this.flying=!0,this.moving=!0,this.nextDirection=this.direction,this.registerProjectileEvents()}registerProjectileEvents(){this.on(h.Damaged,()=>{this.explode()})}explode(){super.explode(),this.emit(h.WillDoDamage,this.calculateExplosionRect())}stateCheck(){this.canMove?this.movePace===1&&(this.movePace=2,this.moveSpeed=this.moveSpeedPrev):this.movePace===2?(this.movePace=1,this.moveSpeedPrev=this.moveSpeed,this.moveSpeed=this.moveStepsTotal-1,this.canMove=!0,this.moveStepsProgress=0):this.explode()}calculateExplosionRect(){switch(this.direction){case d.Up:return{posX:this.posX-this.explosionRadius,posY:this.posY-this.explosionForce,width:this.width+this.explosionRadius*2,height:this.height};case d.Down:return{posX:this.posX-this.explosionRadius,posY:this.posY+this.explosionForce,width:this.width+this.explosionRadius*2,height:this.height};case d.Left:return{posX:this.posX-this.explosionForce,posY:this.posY-this.explosionRadius,width:this.width,height:this.height+this.explosionRadius*2};case d.Right:return{posX:this.posX+this.explosionForce,posY:this.posY-this.explosionRadius,width:this.width,height:this.height+this.explosionRadius*2}}}}class dt extends X{constructor(e){super({posX:0,posY:0});r(this,"points",100);r(this,"despawnTime",100);this.type="score",this.crossable=!0,this.hittable=!1,this.color="transparent",Object.assign(this,this.calculateProps(e)),this.registerScoreEvents()}registerScoreEvents(){this.on(h.Spawn,()=>{this.setLoopDelay(()=>{this.despawn()},this.despawnTime)})}calculateProps({points:e,parent:t}){let o;switch(e){case 500:o=p["points.500"];break;case 400:o=p["points.400"];break;case 300:o=p["points.300"];break;case 200:o=p["points.200"];break;case 100:o=p["points.100"];break;default:o=null}return{mainSpriteCoordinates:o,posX:t.posX,posY:t.posY,width:t.width,height:t.height}}}var L=(i=>(i.Low="LOW",i.Medium="MEDIUM",i.High="HIGH",i))(L||{});class _ extends fe{constructor(e){super({...e,type:"tank"});r(this,"width",4);r(this,"height",4);r(this,"movePace",2);r(this,"moveSpeed",3);r(this,"moveStepsTotal",13);r(this,"shootSpeed",2);r(this,"spawnTimeout",1e3);r(this,"canShoot",!1);r(this,"projectilesLimit",1);r(this,"projectilesFlying",0);r(this,"shootForce",1);r(this,"shooting",!1);r(this,"frozen",!0);r(this,"invincible",!1);r(this,"sliding",!1);r(this,"slidingStepsProgress",0);r(this,"slidingStepsTotal",20);r(this,"durability",1);Object.assign(this,e),this.color=e.color||u.Yellow,this.registerTankEvents()}registerTankEvents(){this.on(h.Spawn,()=>{this.startAnimation({delay:50,spriteCoordinates:p.spawn,looped:!0,stopTimer:this.spawnTimeout});const e=this.color;this.color=u.LightCyan,this.hittable=!1,this.setLoopDelay(()=>{this.frozen=!1,this.canShoot=!0,this.hittable=!0,this.color=e,this.emit(h.Ready)},this.spawnTimeout)}),this.on(h.Damaged,({source:e})=>{!this.invincible&&this.role!==e.role&&--this.durability<=0&&this.beDestroyed(e)})}setMoveSpeed(e){switch(e){case L.Low:this.moveSpeed=0;break;case L.Medium:this.moveSpeed=3;break;case L.High:this.moveSpeed=6;break}}setShootSpeed(e){switch(e){case L.Low:this.shootSpeed=1;break;case L.Medium:this.shootSpeed=2;break;case L.High:this.shootSpeed=3;break}}shoot(){!this.spawned||this.frozen||!this.canShoot||this.projectilesFlying>=this.projectilesLimit||(this.shooting=!0)}stateCheck(){if(this.sliding&&(!this.canMove||++this.slidingStepsProgress>this.slidingStepsTotal?this.sliding=!1:this.stopping=!0),!this.shooting)return;const e=new V({parent:this,...this.calculateProjectileInitPos(),role:this.role,direction:this.direction,moveSpeed:this.shootSpeed,explosionForce:this.shootForce});++this.projectilesFlying,e.on(h.Exploding,()=>{--this.projectilesFlying}),this.emit(h.Shoot,e),this.shooting=!1}calculateProjectileInitPos(){const e={width:2,height:2},t=this.nextRect||this.lastRect||this.getRect(),o=Math.round((t.width-e.width)/2),a=Math.round((t.height-e.height)/2);switch(this.direction){case d.Up:return{posX:t.posX+o,posY:t.posY};case d.Down:return{posX:t.posX+o,posY:t.posY+t.height-e.height};case d.Left:return{posX:t.posX,posY:t.posY+a};case d.Right:return{posX:t.posX+t.width-e.width,posY:t.posY+a}}}slide(e=!0){e?(this.sliding||this.emit(h.Slide),this.sliding=!0,this.slidingStepsProgress=0):this.sliding=!1}}class ge extends _{constructor(e){super({posX:0,posY:0});r(this,"lastDirection",d.Down);r(this,"variant","BASIC");r(this,"flashing",!1);r(this,"difficulty",x.Hard);r(this,"minReactionTime",500);r(this,"maxReactionTime",1e3);r(this,"turnChance",1);r(this,"keepMovingChance",5);r(this,"moveUpChance",1);r(this,"moveDownChance",6);r(this,"moveSidewaysChance",3);r(this,"secondarySpriteCoordinates",null);switch(this.color=u.Aqua,this.role="enemy",Object.assign(this,e),this.difficulty===x.Easy&&(this.minReactionTime=1e3,this.maxReactionTime=2e3,this.moveUpChance=2,this.moveDownChance=3,this.keepMovingChance=3),this.variant){case"FAST":this.setMoveSpeed(L.High),this.setShootSpeed(L.Medium),this.mainSpriteCoordinates=p["tank.enemy.default.b"],this.secondarySpriteCoordinates=p["tank.enemy.danger.b"];break;case"POWER":this.setMoveSpeed(L.Medium),this.setShootSpeed(L.High),this.mainSpriteCoordinates=p["tank.enemy.default.c"],this.secondarySpriteCoordinates=p["tank.enemy.danger.c"];break;case"ARMOR":this.setMoveSpeed(L.Low),this.setShootSpeed(L.Medium),this.durability=4,this.mainSpriteCoordinates=p["tank.enemy.secondary.d"],this.secondarySpriteCoordinates=p["tank.enemy.danger.d"];break;default:this.setMoveSpeed(L.Low),this.setShootSpeed(L.Low),this.mainSpriteCoordinates=p["tank.enemy.default.a"],this.secondarySpriteCoordinates=p["tank.enemy.danger.a"]}this.registerTankEnemyEvents()}registerTankEnemyEvents(){this.on(h.Ready,()=>{this.move(d.Down),this.autoMove(),this.autoShoot(),this.flashing&&this.setFlashing()}),this.on(h.Damaged,()=>{this.variant==="ARMOR"&&(this.durability===3&&(this.mainSpriteCoordinates=p["tank.enemy.primary.d"]),this.durability===2&&(this.mainSpriteCoordinates=p["tank.enemy.secondary.d"]),this.durability===1&&(this.mainSpriteCoordinates=p["tank.enemy.default.d"]),this.secondarySpriteCoordinates=p["tank.enemy.danger.d"],this.refreshSprite())})}setFlashing(){const t="flashing"+$(0,999999);this.setLoopInterval(()=>{const o=this.mainSpriteCoordinates;this.mainSpriteCoordinates=this.secondarySpriteCoordinates,this.secondarySpriteCoordinates=o,this.refreshSprite()},200,t)}autoMove(){this.setLoopDelay(()=>{this.spawned&&(this.move(this.getMoveDirection()),this.autoMove())},$(this.minReactionTime,this.maxReactionTime))}autoShoot(){this.setLoopDelay(()=>{this.spawned&&(this.shoot(),this.autoShoot())},$(this.minReactionTime,this.maxReactionTime))}getRandomDirection(){const e=[...new Array(this.moveUpChance).fill(d.Up),...new Array(this.moveDownChance).fill(d.Down),...new Array(this.moveSidewaysChance).fill(d.Left),...new Array(this.moveSidewaysChance).fill(d.Right)];return e[Math.floor(Math.random()*e.length)]}getRandomAction(){const e=[...new Array(this.turnChance).fill("turn"),...new Array(this.keepMovingChance).fill("move")];return e[Math.floor(Math.random()*e.length)]}getMoveDirection(){if(this.canMove&&this.getRandomAction()==="move")return this.direction;let e;do e=this.getRandomDirection();while(this.lastDirection===e||e===d.Up&&this.posY===2||e===d.Down&&this.posY===50||e===d.Left&&this.posX===2||e===d.Right&&this.posX===50);return this.lastDirection=e,e}}class Z extends _{constructor(e){super({posX:0,posY:0});r(this,"variant","PLAYER1");r(this,"spawnShieldTimeout",3e3);r(this,"upgradeTier",1);this.role="player",Object.assign(this,e),this.updateTankSpecs(),this.registerTankPlayerEvents()}registerTankPlayerEvents(){this.on(h.Ready,()=>{this.useShield(this.spawnShieldTimeout)})}useShield(e){this.startAnimation({delay:50,spriteCoordinates:p.shield,looped:!0,stopTimer:e,showMainSprite:!0}),this.invincible=!0,this.setLoopDelay(()=>{this.invincible=!1},e)}upgrade(){++this.upgradeTier,this.updateTankSpecs()}updateTankSpecs(){const e=this.variant==="PLAYER1";this.upgradeTier>=1&&(this.setMoveSpeed(L.Medium),this.setShootSpeed(L.Medium),this.mainSpriteCoordinates=e?p["tank.player.primary.a"]:p["tank.player.secondary.a"]),this.upgradeTier>=2&&(this.setShootSpeed(L.High),this.mainSpriteCoordinates=e?p["tank.player.primary.b"]:p["tank.player.secondary.b"]),this.upgradeTier>=3&&(this.projectilesLimit=2,this.mainSpriteCoordinates=e?p["tank.player.primary.c"]:p["tank.player.secondary.c"]),this.upgradeTier>=4&&(this.shootForce=2,this.mainSpriteCoordinates=e?p["tank.player.primary.d"]:p["tank.player.secondary.d"]),this.refreshSprite()}}class He extends X{constructor(e){super(e);r(this,"variant","WHOLE");r(this,"damagedCells",{});switch(Object.assign(this,e),this.role="neutral",this.type){case"boundary":this.crossable=!1,this.hittable=!0,this.color=u.Grey;break;case"brickWall":this.crossable=!1,this.hittable=!0,this.color=u.Brown,this.mainSpriteCoordinates=p["terrain.brick"][this.variant];break;case"concreteWall":this.crossable=!1,this.hittable=!0,this.color=u.LightGrey,this.mainSpriteCoordinates=p["terrain.concrete"][this.variant];break;case"trees":this.crossable=!0,this.hittable=!1,this.color=u.Green,this.mainSpriteCoordinates=p["terrain.trees"];break;case"water":this.crossable=!1,this.hittable=!1,this.color=u.Blue,this.mainSpriteCoordinates=p["terrain.water"];break;case"ice":this.crossable=!0,this.hittable=!1,this.color=u.AliceBlue,this.mainSpriteCoordinates=p["terrain.ice"];break}this.registerTerrainEvents()}registerTerrainEvents(){this.type==="water"&&this.on(h.Spawn,()=>{this.startAnimation({delay:350,spriteCoordinates:p["terrain.water"],looped:!0})}),this.type==="brickWall"&&this.on(h.Damaged,e=>{this.emit(h.Destroyed,e)}),this.type==="concreteWall"&&this.on(h.Damaged,e=>{const t=e.source.explosionForce;if(!t||t<2)return;const o=e.posX+"X"+e.posY;this.damagedCells[o]&&this.emit(h.Destroyed,e),this.damagedCells[o]=!0})}}function Pe(i){return i in ye}class pt extends A{constructor(e){super();r(this,"isStopped",!1);r(this,"isMuteKeyPressed",!1);r(this,"isPauseKeyPressed",!1);r(this,"context");r(this,"activatedSounds",{});this.game=e,this.registerGlobalEvents(),this.context=this.game.resources.audioContext}getSound(e){return this.game.resources.getSound(e)}load(){this.isStopped=!1,this.isMuteKeyPressed=!1,this.isPauseKeyPressed=!1,this.reset()}unload(){this.reset()}reset(){this.pauseSoundAll(),this.activatedSounds={}}registerGlobalEvents(){this.on("levelIntro",()=>{this.playSound("levelIntro")}),this.on("gameOver",()=>{this.pauseSoundAll(),this.playSound("gameOver")});let e=!1;this.on("score",()=>{e?this.playSound("score2"):this.playSound("score"),e=!e}),this.on("pause",({isMuteKey:t=!1})=>{t?this.isMuteKeyPressed=!this.isMuteKeyPressed:this.isPauseKeyPressed=!this.isPauseKeyPressed,!(this.isMuteKeyPressed&&!t||this.isPauseKeyPressed&&t)&&(this.isStopped?(this.isStopped=!1,this.playSound("pause"),this.resumeSoundAll()):(this.pauseSoundAll(),this.isMuteKeyPressed||this.playSound("pause"),this.isStopped=!0))})}add(e){const t=e instanceof _,o=e.role==="player",a=e.role==="enemy",n=e instanceof He,l=e instanceof re;t&&o&&(e.on(h.Ready,()=>{e.moving?this.playSound("move"):this.playSound("idle")}),e.on(h.Shoot,()=>{this.playSound("shoot")}),e.on(h.Move,()=>{this.stopSound("idle"),this.playSound("move")}),e.on(h.Stop,()=>{this.stopSound("move"),this.playSound("idle")}),e.on(h.Slide,()=>{this.playSound("ice")}),e.on(h.Destroyed,()=>{this.stopSound("move"),this.stopSound("idle"),this.playSound("playerExplosion")})),n&&(e.type==="brickWall"&&e.on(h.Damaged,m=>{m.source.role==="player"&&this.playSound("hitBrick")}),(e.type==="boundary"||e.type==="concreteWall")&&e.on(h.Damaged,m=>{m.source.role==="player"&&this.playSound("hitSteel")})),l&&(e.on(h.Spawn,()=>{this.playSound("powerupAppear")}),e.on(h.Destroyed,()=>{e.variant==="TANK"?this.playSound("lifePickup"):this.playSound("powerupPickup")})),t&&a&&(e.on(h.Damaged,m=>{!e.shouldBeDestroyed&&m.source.role==="player"&&this.playSound("hitEnemy")}),e.on(h.Destroyed,()=>{this.playSound("enemyExplosion")}))}playSound(e,t=0){var m,y,f;if(this.isStopped)return;(m=this.activatedSounds[e])!=null&&m.isPlaying&&this.stopSound(e);const o=this.context.createBufferSource();o.buffer=this.getSound(e);const a="idle";o.loop=e===a;const n=this.context.createGain(),l=e==="idle"||e==="move"||e==="ice";n.gain.value=l?.4:1,o.connect(n),n.connect(this.context.destination),o.start(0,t),this.activatedSounds[e]={audio:o,isPlaying:!0,startTime:this.context.currentTime-((f=(y=this.activatedSounds[e])==null?void 0:y.resumeFrom)!=null?f:0),resumeFrom:0},o.onended=()=>{!this.isStopped&&this.activatedSounds[e]&&(this.activatedSounds[e].isEnded=!0)}}stopSound(e){const t=this.activatedSounds[e];t!=null&&t.isPlaying&&(t.audio.stop(),t.isPlaying=!1,t.resumeFrom=this.context.currentTime-t.startTime)}pauseSound(e){const t=this.activatedSounds[e];!this.isStopped&&t.isPlaying&&this.stopSound(e)}pauseSoundAll(){Object.keys(this.activatedSounds).forEach(e=>{Pe(e)&&this.pauseSound(e)})}resumeSound(e){const t=this.activatedSounds[e];!this.isStopped&&!t.isPlaying&&!t.isEnded&&this.playSound(e,t.resumeFrom)}resumeSoundAll(){Object.keys(this.activatedSounds).forEach(e=>{Pe(e)&&this.resumeSound(e)})}}var c=(i=>(i.Stop="STOP",i.Move="MOVE",i.Shoot="SHOOT",i.Pause="PAUSE",i.Fullscreen="FULLSCREEN",i.Mute="MUTE",i.Escape="ESCAPE",i.ToggleJoystickType="TOGGLE_JOYSTICK_TYPE",i))(c||{}),N=(i=>(i.Pause="PAUSE",i.Mute="MUTE",i.Fullscreen="FULLSCREEN",i))(N||{}),v=(i=>(i.ShootBtn="controller__shoot-btn",i.MoveUpBtn="joystick__up-button",i.MoveRightBtn="joystick__right-button",i.MoveLeftBtn="joystick__left-button",i.MoveDownBtn="joystick__bottom-button",i.PauseBtn="controller__service-btn_pause",i.MuteBtn="controller__service-btn_mute",i.FullscreenBtn="controller__service-btn_fullscreen",i.DefaultServiceBtn="controller__service-btn",i.ActivatedServiceBtn="controller__service-btn_activated",i.FullscreenWrapper="game__fullscreen-wrapper",i))(v||{}),ne=(i=>(i.Stick="\u0421\u0422\u0418\u041A",i.ButtonJoystick="\u041A\u041D\u041E\u041F\u041A\u0418",i))(ne||{});const ae="JoystickType";class Se extends A{constructor(){super();r(this,"activeDirection",{});r(this,"shootProcess",null);r(this,"shootIntervalMs",200)}load(){this.registerEvents()}unload(){this.disableEvents()}reset(){return this.clearAllListeners(),this}emitBindingAction([e,t]){e===c.Move&&(this.activeDirection[t]=!0),this.emit(e,t),e===c.Shoot&&(this.shootProcess&&(clearInterval(this.shootProcess),this.shootProcess=null),this.shootProcess=setInterval(()=>{this.emit(e)},this.shootIntervalMs))}stopBindingAction([e,t]){if(e===c.Move){delete this.activeDirection[t];const o=Object.keys(this.activeDirection);o.length?this.emit(e,o[0]):this.emit(c.Stop)}e===c.Shoot&&this.shootProcess&&(clearInterval(this.shootProcess),this.shootProcess=null)}}class Me extends Se{constructor(e){super();r(this,"keyBindings");r(this,"startControlByEvent",e=>{if(!(e instanceof KeyboardEvent)||e.repeat)return!1;const t=this.getKeyBinding(e.code);t&&(this.emitBindingAction(t),this.preventDefaultEvent(e))});r(this,"stopControlByEvent",e=>{if(!(e instanceof KeyboardEvent))return!1;const t=this.getKeyBinding(e.code);t&&(this.stopBindingAction(t),this.preventDefaultEvent(e))});this.keyBindings=e}registerEvents(){document.addEventListener("keydown",this.startControlByEvent),document.addEventListener("keyup",this.stopControlByEvent)}disableEvents(){document.removeEventListener("keydown",this.startControlByEvent),document.removeEventListener("keyup",this.stopControlByEvent)}preventDefaultEvent(e){e instanceof KeyboardEvent&&!e.ctrlKey&&!e.shiftKey&&!e.altKey&&e.preventDefault()}getKeyBinding(e){return this.keyBindings[e]||null}}class Re extends A{constructor(e,t){super();r(this,"controllersList",[]);this.game=e,this.controllersList=t}on(e,t){return super.on(e,t),this.controllersList.forEach(o=>{o.on(e,t)}),this}emit(e,...t){super.emit(e,...t),this.controllersList.forEach(o=>{o.emit(e,...t)})}off(e,t){return super.off(e,t),this.controllersList.forEach(o=>{o.off(e,t)}),this}offAll(e){return super.offAll(e),this.controllersList.forEach(t=>{t.offAll(e)}),this}clearAllListeners(){super.clearAllListeners(),this.controllersList.forEach(e=>{e.clearAllListeners()})}load(){this.controllersList.forEach(e=>e.load())}unload(){this.controllersList.forEach(e=>e.unload())}reset(){return this.controllersList.forEach(e=>e.reset()),this}startControlByEvent(e){this.controllersList.forEach(t=>t.startControlByEvent(e))}stopControlByEvent(e){this.controllersList.forEach(t=>t.stopControlByEvent(e))}stopControlForce(){this.controllersList.forEach(e=>{e.stopControlForce&&e.stopControlForce()})}changeJoystickType(){const e=this.game.state,t=Object.values(ne),o=t.indexOf(e.joystickType),a=o===t.length-1?0:o+1;e.joystickType=t[a],localStorage.setItem(ae,e.joystickType),this.emit(c.ToggleJoystickType),this.stopControlForce()}}class Be extends Se{constructor({pointerBindings:e,type:t}){super();r(this,"pointerBindings");r(this,"startEventName");r(this,"stopEventName");r(this,"startControlByEvent",e=>{if(!(e instanceof Event)||!e.target)return;const t=this.getPointerBinding(e.target);t&&(e.preventDefault(),this.emitBindingAction(t))});r(this,"stopControlByEvent",e=>{if(!(e instanceof Event)||!e.target)return;const t=this.getPointerBinding(e.target);t&&(e.preventDefault(),this.stopBindingAction(t))});r(this,"stopControlForce",()=>{this.activeDirection={}});this.pointerBindings=e,t==="touchscreen"?(this.startEventName="touchstart",this.stopEventName="touchend"):(this.startEventName="mousedown",this.stopEventName="mouseup")}registerEvents(){document.addEventListener(this.startEventName,this.startControlByEvent,{passive:!1}),document.addEventListener(this.stopEventName,this.stopControlByEvent,{passive:!1})}disableEvents(){document.removeEventListener(this.startEventName,this.startControlByEvent),document.removeEventListener(this.stopEventName,this.stopControlByEvent)}getPointerBinding(e){if(!(e instanceof HTMLElement||e instanceof SVGElement)||!this.pointerBindings)return;let t=null;for(const[o,a]of Object.entries(this.pointerBindings))if(e.closest(`.${o}`)){t=a;break}return t}}class mt extends Se{constructor(e){super();r(this,"stickBindings");r(this,"startControlByEvent",e=>{!e||e instanceof Event||this.emitBindingAction(this.stickBindings[e])});r(this,"stopControlByEvent",e=>{!e||e instanceof Event||this.stopBindingAction(this.stickBindings[e])});r(this,"stopControlForce",()=>{this.activeDirection={}});this.stickBindings=e}registerEvents(){}disableEvents(){}}class gt{constructor(s){r(this,"errorOutputMethod",alert);r(this,"active",!1);r(this,"errorHandler",s=>{var t;const e={message:s.message,file:s.filename,line:s.lineno,column:s.colno,target:((t=s.target)==null?void 0:t.toString())||""};this.reportError(e)});this.game=s,this.load()}load(){!this.active&&this.game.state.debugging&&typeof window<"u"&&(window.addEventListener("error",this.errorHandler),this.active=!0)}unload(){this.game.state.debugging&&typeof window<"u"&&(window.removeEventListener("error",this.errorHandler),this.active=!1)}reportError(s){let e="";for(const[t,o]of Object.entries(s))e+=`${t.toUpperCase()}: ${o}

`;this.errorOutputMethod.call(null,e)}}const b=()=>"ontouchstart"in window;var E=(i=>(i.Singleplayer="SINGLEPLAYER",i.Multiplayer="MULTIPLAYER",i.JoystickType="JOYSTICK_TYPE",i.Difficulty="DIFFICULTY",i.Style="STYLE",i))(E||{});class W{constructor(s){this.overlay=s}}class ft extends W{show(){this.overlay.animate(this.updateStage.bind(this))}updateStage(s=0){const{view:e}=this.overlay,t=5,o=e.height-s,a=(e.height-t)/2,n=s<=10?s*.05:.5;return o<a?!1:(this.overlay.clearScreen(),this.overlay.renderElement({posX:0,posY:0,width:e.width,height:e.height,color:`rgba(0,0,0,${n})`}),this.overlay.renderElement({posX:0,posY:o,width:e.width,height:t,text:"\u041F\u041E\u0422\u0420\u0410\u0427\u0415\u041D\u041E",color:u.Red,align:"center"}),!0)}}class yt extends W{show(){this.overlay.animate(this.updateStage.bind(this))}updateStage(s=0){const{view:e}=this.overlay,t=e.width,o=Math.round(e.height/2)-s;return o<0?!1:(this.overlay.clearScreen(),this.overlay.renderElement({posX:0,posY:0,width:t,height:o,color:u.Grey}),this.overlay.renderElement({posX:0,posY:o+s*2,width:t,height:o,color:u.Grey}),!0)}}class vt extends W{show({level:s,showHints:e=!0}){this.overlay.renderSplashScreen(u.Grey);const t=`\u0423\u0420\u041E\u0412\u0415\u041D\u042C ${s.toString().padStart(2," ")}`;this.overlay.renderElement({posX:0,posY:Math.round(this.overlay.view.height/2)-2,width:this.overlay.view.width,height:2,color:u.Black,text:t,align:"center"}),e&&(this.overlay.renderElement({posX:0,posY:50,width:this.overlay.view.width,height:b()?1.5:1,color:u.Black,text:"\u0414\u041B\u042F \u0412\u042B\u0411\u041E\u0420\u0410 \u0423\u0420\u041E\u0412\u041D\u042F \u0412\u041E\u0421\u041F\u041E\u041B\u042C\u0417\u0423\u0419\u0422\u0415\u0421\u042C",align:"center"}),this.overlay.renderElement({posX:0,posY:b()?52.7:52,width:this.overlay.view.width,height:b()?1.5:1,color:u.Black,text:"\u0421\u0422\u0420\u0415\u041B\u041A\u0410\u041C\u0418 \u0412\u0412\u0415\u0420\u0425 \u0418 \u0412\u041D\u0418\u0417",align:"center"}))}}class St extends W{show(){this.showPause(1),this.overlay.animate(this.animatePause.bind(this),500)}animatePause(s=0){const e=Xe(s)?0:1;return this.overlay.clearScreen(),this.overlay.game.state.paused?(this.showPause(e),!0):!1}showPause(s){const{view:e}=this.overlay,t=5;this.overlay.renderElement({posX:0,posY:0,width:e.width,height:e.height,color:"rgba(0,0,0,.5)"}),this.overlay.renderElement({posX:0,posY:(e.height-t)/2,width:e.width,height:t,text:"\u041F\u0410\u0423\u0417\u0410",color:`rgba(255,0,0,${s})`,align:"center"})}}class Et extends W{constructor(){super(...arguments);r(this,"animationInterval",150);r(this,"mode");r(this,"sizing");r(this,"currentPosY",0);r(this,"enemyTankSprites",[p["tank.enemy.default.a"].UP,p["tank.enemy.default.b"].UP,p["tank.enemy.default.c"].UP,p["tank.enemy.default.d"].UP]);r(this,"level");r(this,"playerOneName","\u0418\u0413\u0420\u041E\u041A 1");r(this,"playerTwoName","\u0418\u0413\u0420\u041E\u041A 2");r(this,"sessionScore");r(this,"mapEnemiesKilledTotal");r(this,"mapEnemiesKilledCount");r(this,"mapEnemiesKilledScore");r(this,"categories");r(this,"allowedItemsCounter")}show(e){this.sizing={full:this.overlay.view.width,half:Math.round(this.overlay.view.width/2),third:Math.round(this.overlay.view.width/3)},this.mode=e.mode,e.username&&this.mode==="SINGLEPLAYER"&&(this.playerOneName=e.username),this.level=e.level,this.sessionScore=e.sessionScore,this.mapEnemiesKilledTotal=e.mapEnemiesKilledTotal,this.mapEnemiesKilledCount=Object.values(e.mapEnemiesKilledCount),this.mapEnemiesKilledScore=Object.values(e.mapEnemiesKilledScore),this.categories=this.mapEnemiesKilledCount.length,this.allowedItemsCounter=new Array(this.categories).fill(-1),e.skip?(this.allowedItemsCounter=new Array(this.categories).fill(20),this.update()):this.overlay.animate(this.update.bind(this),this.animationInterval)}update(e=0){if(e>27)return!1;this.overlay.clearScreen(),this.overlay.renderSplashScreen(),this.renderHeader(),this.currentPosY=20;let t=!1;for(let o=0;o<this.categories;++o){const a=this.enemyTankSprites[o];if(o!==0&&this.allowedItemsCounter[o]===-1){this.renderCategory({score:[" "," "],count:[" "," "],enemyTankSprite:a});continue}const l=0,m=1;let y=this.mapEnemiesKilledScore[o];const f=[...this.mapEnemiesKilledCount[o]];let w=Math.max(...y)/Math.max(...f);(isNaN(w)||w===1/0)&&(w=1);const I=this.allowedItemsCounter[o]>Math.max(...f),M=typeof this.allowedItemsCounter[o+1]<"u",P=this.allowedItemsCounter[o+1]===-1;if(I)M?P&&(this.allowedItemsCounter[o+1]=0):t=!0;else{++this.allowedItemsCounter[o];const J=this.allowedItemsCounter[o]<f[l],ue=this.allowedItemsCounter[o]<f[m];J&&(f[l]=this.allowedItemsCounter[o]),ue&&(f[m]=this.allowedItemsCounter[o]),this.allowedItemsCounter[o]>0&&this.allowedItemsCounter[o]<=Math.max(...f)&&this.overlay.emit("score")}y=[f[l]*w,f[m]*w],this.renderCategory({score:y,count:f,enemyTankSprite:a})}return this.renderFooter({count:t?this.mapEnemiesKilledTotal:[" "," "]}),this.renderNote(),!0}renderHeader(){this.overlay.renderElement({posX:0,posY:12,width:this.sizing.full,height:2,align:"center",color:u.White,text:`\u0423\u0420\u041E\u0412\u0415\u041D\u042C ${this.level}`}),this.overlay.renderElement({posX:0,posY:16,width:this.sizing.third,height:2,align:"right",color:u.Red,text:this.playerOneName}),this.overlay.renderElement({posX:0,posY:20,width:this.sizing.third,height:2,align:"right",color:u.Orange,text:`${this.sessionScore[0]}`}),this.mode!=="SINGLEPLAYER"&&(this.overlay.renderElement({posX:this.sizing.third*2,posY:16,width:this.sizing.third,height:2,align:"left",color:u.Red,text:this.playerTwoName}),this.overlay.renderElement({posX:this.sizing.third*2,posY:20,width:this.sizing.third,height:2,align:"left",color:u.Orange,text:`${this.sessionScore[1]}`}))}renderCategory({score:e,count:t,enemyTankSprite:o}){this.currentPosY+=5,this.overlay.renderElement({posX:0,posY:this.currentPosY,width:this.sizing.third,height:2,align:"right",color:"white",text:`${e[0]} \u041E\u0427\u041A\u041E\u0412`}),this.overlay.renderElement({posX:0,posY:this.currentPosY,width:this.sizing.half-1.5,height:2,align:"right",color:u.White,text:`${t[0]}<`}),this.overlay.renderElement({posX:this.sizing.half-1,posY:this.currentPosY-.8,width:3,height:3,mainSpriteCoordinates:o,backColor:u.Black}),this.mode!=="SINGLEPLAYER"&&(this.overlay.renderElement({posX:this.sizing.half+2.5,posY:this.currentPosY,width:this.sizing.half-2.5,height:2,align:"left",color:u.White,text:`>${t[1]}`}),this.overlay.renderElement({posX:this.sizing.third*2,posY:this.currentPosY,width:this.sizing.third,height:2,align:"left",color:u.White,text:`${e[1]} \u041E\u0427\u041A\u041E\u0412`}))}renderFooter({count:e}){this.overlay.renderElement({posX:this.sizing.third+2,posY:this.currentPosY+3.5,width:this.sizing.third-4,height:.5,color:u.White}),this.overlay.renderElement({posX:0,posY:this.currentPosY+5,width:this.sizing.third,height:2,align:"right",color:u.White,text:"\u0412\u0421\u0415\u0413\u041E"}),this.overlay.renderElement({posX:0,posY:this.currentPosY+5,width:this.sizing.half-1.5,height:2,align:"right",color:"white",text:`${e[0]} `}),this.mode!=="SINGLEPLAYER"&&(this.overlay.renderElement({posX:this.sizing.half+2.5,posY:this.currentPosY+5,width:this.sizing.half-2.5,height:2,align:"left",color:u.White,text:` ${e[1]}`}),this.overlay.renderElement({posX:this.sizing.third*2,posY:this.currentPosY+5,width:this.sizing.third,height:2,align:"left",color:u.White,text:"\u0412\u0421\u0415\u0413\u041E"}))}renderNote(){this.overlay.game.state.difficulty===x.Easy&&this.overlay.renderElement({posX:0,posY:this.currentPosY+10,width:this.sizing.full,height:1,align:"center",color:u.Grey,text:"\u0417\u0430 \u043F\u0440\u043E\u0441\u0442\u043E\u0439 \u0443\u0440\u043E\u0432\u0435\u043D\u044C \u0441\u043B\u043E\u0436\u043D\u043E\u0441\u0442\u0438 \u043D\u0430\u0447\u0438\u0441\u043B\u044F\u0435\u0442\u0441\u044F \u0432 \u0434\u0432\u0430 \u0440\u0430\u0437\u0430 \u043C\u0435\u043D\u044C\u0448\u0435 \u043E\u0447\u043A\u043E\u0432"})}}class wt extends W{show(){this.overlay.renderSplashScreen(),this.overlay.renderElement({posX:0,posY:26,width:this.overlay.view.width,height:4,color:u.White,text:"\u0417\u0410\u0413\u0420\u0423\u0417\u041A\u0410...",align:"center"})}}class Tt extends W{constructor(){super(...arguments);r(this,"tankElemInterval",null);r(this,"mainMenuStateXPos",b()?19:23);r(this,"mainMenuStateYPos",{[E.Singleplayer]:26,[E.Multiplayer]:b()?0:31,[E.JoystickType]:b()?31:0,[E.Difficulty]:36,[E.Style]:41})}show(e){this.render(),this.overlay.renderElement({posX:this.mainMenuStateXPos-6,posY:this.mainMenuStateYPos[e]+-1,width:4,height:4,color:u.Yellow,backColor:u.Black,mainSpriteCoordinates:p["tank.player.primary.a"].RIGHT}).startAnimation({delay:25,spriteCoordinates:p["tank.player.primary.a"].RIGHT,name:"menuTank",looped:!0})}render(){const{view:e}=this.overlay,t=this.overlay.game.state,o=H[t.themeName].brickBg;this.overlay.renderSplashScreen(),this.overlay.renderElement({posX:0,posY:4,width:e.width,height:7,backImg:this.overlay.game.resources.getImage(o),text:"\u0422\u0410\u041D\u0427\u0418\u041A\u0418",align:"center"}),this.overlay.renderElement({posX:0,posY:13,width:e.width,height:7,backImg:this.overlay.game.resources.getImage(o),text:"2023",align:"center"}),this.overlay.renderElement({posX:this.mainMenuStateXPos,posY:this.mainMenuStateYPos[E.Singleplayer],width:24,height:2.2,color:u.White,text:b()?"\u0421\u0422\u0410\u0420\u0422":"1 \u0418\u0413\u0420\u041E\u041A"}),b()||this.overlay.renderElement({posX:this.mainMenuStateXPos,posY:this.mainMenuStateYPos[E.Multiplayer],width:20,height:2.2,color:u.White,text:"2 \u0418\u0413\u0420\u041E\u041A\u0410"}),this.overlay.renderElement({posX:this.mainMenuStateXPos,posY:this.mainMenuStateYPos[E.Difficulty],width:24,height:2.2,color:u.White,text:"\u0412\u0420\u0410\u0413\u0418: "+(t.difficulty===x.Easy?"\u041F\u0420\u041E\u0421\u0422\u042B\u0415":"\u0421\u041B\u041E\u0416\u041D\u042B\u0415")}),this.overlay.renderElement({posX:this.mainMenuStateXPos,posY:this.mainMenuStateYPos[E.Style],width:24,height:2.2,color:u.White,text:"\u0421\u0422\u0418\u041B\u042C: "+H[t.themeName].menuTitle}),b()&&this.overlay.renderElement({posX:this.mainMenuStateXPos,posY:this.mainMenuStateYPos[E.JoystickType],width:22,height:2.2,color:u.White,text:"\u0423\u041F\u0420\u0410\u0412\u041B\u0415\u041D\u0418\u0415: "+t.joystickType}),this.overlay.renderElement({posX:0,posY:50,width:e.width,height:b()?1.5:1,color:u.LightGrey,text:b()?"\u0414\u0416\u041E\u0419\u0421\u0422\u0418\u041A \u0414\u041B\u042F \u0414\u0412\u0418\u0416\u0415\u041D\u0418\u042F":"WASD \u0418\u041B\u0418 \u0421\u0422\u0420\u0415\u041B\u041A\u0418 \u0414\u041B\u042F \u0414\u0412\u0418\u0416\u0415\u041D\u0418\u042F",align:"center"}),this.overlay.renderElement({posX:0,posY:b()?52.7:52,width:e.width,height:b()?1.5:1,color:u.LightGrey,text:b()?"\u041E\u0413\u041E\u041D\u042C \u0414\u041B\u042F \u0412\u042B\u0411\u041E\u0420\u0410 \u0412 \u041C\u0415\u041D\u042E \u0418 \u0421\u0422\u0420\u0415\u041B\u042C\u0411\u042B":"\u041F\u0420\u041E\u0411\u0415\u041B \u0418\u041B\u0418 \u0412\u0412\u041E\u0414 \u0414\u041B\u042F \u0421\u0422\u0420\u0415\u041B\u042C\u0411\u042B",align:"center"})}}var S=(i=>(i.Loading="LOADING",i.MainMenu="MAIN_MENU",i.LevelSelector="LEVEL_SELECTOR",i.GameStart="GAME_START",i.Pause="PAUSE",i.Score="SCORE",i.GameOverPopup="GAME_OVER_POPUP",i))(S||{});const bt={[S.Loading]:wt,[S.MainMenu]:Tt,[S.LevelSelector]:vt,[S.GameStart]:yt,[S.Pause]:St,[S.Score]:Et,[S.GameOverPopup]:ft};class Lt extends A{constructor(e){super();r(this,"currentScreen");r(this,"view");r(this,"activeAnimations",new Set);this.game=e,this.view=e.view}load(){this.reset()}unload(){this.reset()}reset(){this.clearAllListeners();for(const e of this.activeAnimations)clearInterval(e);this.activeAnimations=new Set,this.clearScreen(),delete this.currentScreen}show(e,t=null){const o=bt[e];this.currentScreen instanceof o||(this.currentScreen=new o(this)),this.currentScreen.show(t)}clearScreen(){this.view.eraseAllEntitiesOnLayer("overlay")}renderElement(e){const t=new te(e);return this.game.loop.registerTimerHandlers(t),this.view.add(t),t.render(),t}renderSplashScreen(e=u.Black){this.renderElement({posX:0,posY:0,width:this.view.width,height:this.view.height,color:e})}animate(e,t=25){let o=0;const a=setInterval(()=>{e(++o)||(this.activeAnimations.delete(a),clearInterval(a))},t);this.activeAnimations.add(a)}refreshTextEntity(e){this.view.eraseFromLayer(e,"overlay"),this.view.drawTextOnLayer(e,"overlay")}changeMainMenuItem(e){const t=this.game.state,o=Object.values(E),a=o.indexOf(t.mainMenuItem),n=e===d.Up?-1:1;let l=a+n;l<0&&(l=o.length-1),(b()&&o[l]===E.Multiplayer||!b()&&o[l]===E.JoystickType)&&(l+=n),l>=o.length&&(l=0),t.mainMenuItem=o[l]}}class te extends X{constructor(e){super(e);r(this,"text","");r(this,"align","left");r(this,"spawned",!0);r(this,"indicatorName","");this.type=e.indicatorName?"indicator":"custom",Object.assign(this,e)}render(){const e={posX:this.posX,posY:this.posY};this.text?this.emit(h.ShouldRenderText,e):(this.emit(h.ShouldUpdate,e),this.emit(h.DidUpdate,e))}}const je={KeyP:[c.Pause],KeyM:[c.Mute],Minus:[c.Mute],KeyK:[c.Fullscreen],Equal:[c.Fullscreen],Backquote:[c.Fullscreen],Escape:[c.Escape]},xe={KeyW:[c.Move,d.Up],KeyA:[c.Move,d.Left],KeyS:[c.Move,d.Down],KeyD:[c.Move,d.Right],Space:[c.Shoot],...je},Ie={ArrowUp:[c.Move,d.Up],ArrowLeft:[c.Move,d.Left],ArrowDown:[c.Move,d.Down],ArrowRight:[c.Move,d.Right],Enter:[c.Shoot],...je},De={[v.ShootBtn]:[c.Shoot],[v.MoveUpBtn]:[c.Move,d.Up],[v.MoveRightBtn]:[c.Move,d.Right],[v.MoveLeftBtn]:[c.Move,d.Left],[v.MoveDownBtn]:[c.Move,d.Down],[v.PauseBtn]:[c.Pause],[v.MuteBtn]:[c.Mute],[v.FullscreenBtn]:[c.Fullscreen]};var Ee=(i=>(i.Forward="FORWARD",i.Backward="BACKWARD",i.Left="LEFT",i.Right="RIGHT",i))(Ee||{});const kt={FORWARD:[c.Move,d.Up],BACKWARD:[c.Move,d.Down],LEFT:[c.Move,d.Left],RIGHT:[c.Move,d.Right]};var we=(i=>(i.UpdateLeaderboard="UPDATE_LEADERBOARD",i))(we||{}),x=(i=>(i[i.Easy=0]="Easy",i[i.Hard=1]="Hard",i))(x||{});const K=class extends A{constructor(){super();r(this,"state");r(this,"debug");r(this,"resources");r(this,"loop");r(this,"zone");r(this,"view");r(this,"audioManager");r(this,"overlay");r(this,"scenario");r(this,"controllerAll");r(this,"controllerPlayerOne");r(this,"controllerPlayerTwo");r(this,"statistics");this.state=new Ot,this.debug=new gt(this),this.resources=new At(this),this.loop=new Rt,this.zone=new Yt(this),this.view=new Ft(this),this.overlay=new Lt(this),this.audioManager=new pt(this),this.controllerAll=this.createController({...xe,...Ie}),this.controllerPlayerOne=this.createController(xe),this.controllerPlayerTwo=new Me(Ie),this.statistics=new _t(this)}static create(){return K.__instance||(K.__instance=new K),K.__instance}init(e){this.unload(),this.load(e),this.initLoading()}load(e){this.state.load(),this.debug.load(),this.resources.load(),this.view.load(e),this.overlay.load(),this.loop.load(),this.audioManager.load(),this.controllerAll.load(),this.controllerPlayerOne.load(),this.controllerPlayerTwo.load(),this.statistics.load()}unload(){this.clearAllListeners(),this.state.unload(),this.debug.unload(),this.loop.unload(),this.view.unload(),this.overlay.unload(),this.audioManager.unload(),this.controllerAll.unload(),this.controllerPlayerOne.unload(),this.controllerPlayerTwo.unload(),this.statistics.unload()}reset(){this.scenario&&delete this.scenario,this.state.reset(),this.loop.reset(),this.zone.reset(),this.view.reset(),this.overlay.reset(),this.audioManager.reset(),this.controllerAll.reset(),this.controllerPlayerOne.reset(),this.controllerPlayerTwo.reset(),this.statistics.reset()}addEntity(e){this.loop.add(e),this.view.add(e),this.zone.add(e),this.audioManager.add(e),this.statistics.add(e)}updateLeaderboard(e){this.state.username&&this.emit(we.UpdateLeaderboard,{username:this.state.username,...e})}togglePause(e=null){!this.state.inited||(e===!1||this.state.paused?(this.overlay.clearScreen(),this.loop.start(),this.controllerPlayerOne.load(),this.controllerPlayerTwo.load(),this.statistics.startTimer()):(e===!0||!this.state.paused)&&(this.overlay.show(S.Pause),this.loop.stop(),this.controllerPlayerOne.unload(),this.controllerPlayerTwo.unload(),this.statistics.stopTimer()),this.state.paused=!this.state.paused,this.audioManager.emit("pause",this.state.paused))}initLoading(){this.state.screen=S.Loading,this.overlay.show(this.state.screen),this.resources.on(q.Loaded,()=>{this.initMenu()})}initMenu(){this.reset(),this.state.screen=S.MainMenu,this.overlay.show(this.state.screen,this.state.mainMenuItem),this.controllerAll.on(c.Fullscreen,()=>{this.view.toggleFullScreen()}).on(c.Move,e=>{this.state.screen===S.MainMenu&&((e===d.Up||e===d.Down)&&this.overlay.changeMainMenuItem(e),(e===d.Left||e===d.Right)&&(this.state.mainMenuItem===E.Style&&this.view.changeGameTheme(),this.state.mainMenuItem===E.Difficulty&&this.changeGameDifficulty(),this.state.mainMenuItem===E.JoystickType&&this.controllerAll.changeJoystickType&&this.controllerAll.changeJoystickType()),this.overlay.show(this.state.screen,this.state.mainMenuItem))}).on(c.Shoot,async()=>{if(this.state.screen===S.MainMenu){if(this.state.mainMenuItem===E.Style){this.view.changeGameTheme(),this.overlay.show(this.state.screen,this.state.mainMenuItem);return}if(this.state.mainMenuItem===E.Difficulty){this.changeGameDifficulty(),this.overlay.show(this.state.screen,this.state.mainMenuItem);return}if(this.state.mainMenuItem===E.JoystickType&&this.controllerAll.changeJoystickType){this.controllerAll.changeJoystickType(),this.overlay.show(this.state.screen,this.state.mainMenuItem);return}await this.initLevelSelector(),this.initGameLevel(!0),this.emit(O.ToggleVisibilityServiceBtn)}})}changeGameDifficulty(){this.state.difficulty===x.Easy?this.state.difficulty=x.Hard:this.state.difficulty=x.Easy}initLevelSelector(){return new Promise(e=>{this.reset(),this.state.screen=S.LevelSelector,this.overlay.show(S.LevelSelector,{level:this.state.level,showHints:!0});let t;const o=()=>t&&clearInterval(t),a=n=>{let l=!1;(n===d.Up||n===d.Right)&&this.state.level<this.state.maxLevels?(this.state.level++,l=!0):(n===d.Down||n===d.Left)&&this.state.level>1?(this.state.level--,l=!0):o(),l&&this.overlay.show(S.LevelSelector,{level:this.state.level})};this.controllerAll.on(c.Stop,()=>{this.state.screen===S.LevelSelector&&o()}).on(c.Move,n=>{this.state.screen===S.LevelSelector&&(o(),a.call(this,n),t=setInterval(a.bind(this,n),130))}).on(c.Shoot,()=>{this.state.screen===S.LevelSelector&&e()}).on(c.Escape,()=>{this.initMenu()}).on(c.Fullscreen,()=>{this.view.toggleFullScreen()})})}initGameIntro(){return new Promise(e=>{this.overlay.show(S.LevelSelector,{level:this.state.level,showHints:!1}),this.audioManager.emit("levelIntro"),this.controllerAll.on(c.Pause,e),this.controllerAll.on(c.Shoot,e),setTimeout(e,this.state.gameIntroPopupTimeout)}).then(()=>{this.controllerAll.offAll(c.Shoot),this.state.screen=S.GameStart,this.overlay.show(this.state.screen)})}async initGameLevel(e=!1){this.reset(),this.state.mode=this.state.mainMenuItem===E.Singleplayer?E.Singleplayer:E.Multiplayer,e?this.statistics.startSession(this.state.mode):this.state.level<this.state.maxLevels?this.state.level++:this.state.level=1,this.controllerAll.on(c.Pause,()=>{this.togglePause(),this.view.emit(O.ToggleColorServiceBtn,N.Pause)}).on(c.Mute,()=>{this.audioManager.emit("pause",{isMuteKey:!0}),this.view.emit(O.ToggleColorServiceBtn,N.Mute)}).on(c.Fullscreen,()=>{this.view.toggleFullScreen()}),await this.initGameIntro(),this.statistics.startMap(),this.scenario=new Ct(this).on(Y.GameOver,async()=>{this.statistics.finishSession(),this.state.resetSession(),await this.initGameOverPopup(),await this.initGameScore(),this.initMenu()}).on(Y.MissionAccomplished,async()=>{this.statistics.finishMap(),this.controllerAll.offAll(c.Pause),await at(this.state.missionAccomplishedRedirectTimeout),await this.initGameScore(),this.initGameLevel()})}initGameScore(){return new Promise(e=>{const t={level:this.state.level,username:this.state.username},o=this.statistics.getCurrentStatistics();this.reset(),this.state.screen=S.Score,this.overlay.show(this.state.screen,{...t,...o}),this.overlay.on("score",()=>{this.audioManager.emit("score")});const a=()=>{this.overlay.show(this.state.screen,{...t,...o,skip:!0}),this.controllerAll.offAll(c.Escape),this.controllerAll.on(c.Escape,e),this.controllerAll.offAll(c.Shoot),this.controllerAll.on(c.Shoot,e)};this.controllerAll.on(c.Fullscreen,()=>{this.view.toggleFullScreen()}).on(c.Escape,a).on(c.Shoot,a),setTimeout(e,this.state.scoreScreenTimeout)})}initGameOverPopup(){return new Promise(e=>{this.state.screen!==S.GameOverPopup&&(this.state.screen=S.GameOverPopup,this.overlay.show(this.state.screen),this.audioManager.emit("gameOver"),this.controllerAll.reset(),this.controllerPlayerOne.reset(),this.controllerPlayerTwo.reset(),this.emit(O.ToggleVisibilityServiceBtn),this.controllerAll.on(c.Escape,e),setTimeout(e,this.state.gameOverPopupTimeout))})}createController(e){return b()?new Re(this,[new mt(kt),new Be({pointerBindings:De,type:"touchscreen"})]):new Re(this,[new Me(e),new Be({pointerBindings:De,type:"mouse"})])}};let se=K;r(se,"__instance");var R=(i=>(i.Player1="PLAYER1",i.Player2="PLAYER2",i))(R||{});const Pt={PLAYER1:{posX:18,posY:50,color:u.Yellow,variant:"PLAYER1"},PLAYER2:{posX:34,posY:50,color:u.Lime,variant:"PLAYER2"}},ee={[R.Player1]:{header:"1\u2009\u0418",posY:30},[R.Player2]:{header:"2\u2009\u0418",posY:37}};var D=(i=>(i.TankEnemy="ENEMY_TANK_ICON",i.Lives="LIVES",i.PlayerHeader="PLAYER_HEADER",i.PlayerIcon="PLAYER_ICON",i.Flag="FLAG",i.Level="LEVEL",i))(D||{});class Mt{constructor(s){r(this,"tankEnemiesLeftRendered",!1);r(this,"layerName","ceiling");this.game=s,this.renderLevel(s.state.level)}renderTankEnemiesLeft(s){if(!this.tankEnemiesLeftRendered){let e=2,t=56;for(let o=0;o<s;o++)t=Xe(o)?58:56,e=o%2?e:e+2,this.renderElement({posX:t,posY:e,width:2,height:2,color:u.Black,mainSpriteCoordinates:p["ui.enemy"],indicatorName:D.TankEnemy});this.tankEnemiesLeftRendered=!0;return}this.removeEntity(D.TankEnemy)}renderPlayerLives(s,e){this.removeEntity(s+D.Lives),this.renderElement({posX:56,posY:ee[s].posY,width:4,height:2,color:u.Black,text:ee[s].header,indicatorName:D.PlayerHeader}),this.renderElement({posX:56,posY:ee[s].posY+2,width:2,height:2,color:u.Orange,mainSpriteCoordinates:p["ui.player"],indicatorName:D.PlayerIcon}),this.renderElement({posX:58.3,posY:ee[s].posY+2,width:4,height:2,color:u.Black,text:e.toString(),indicatorName:s+D.Lives})}renderLevel(s){this.renderElement({posX:56,posY:44,width:4,height:4,color:u.Orange,mainSpriteCoordinates:p.flag,indicatorName:D.Flag}),this.renderElement({posX:s>9?57:58,posY:48,width:4,height:2,color:u.Black,text:s.toString(),indicatorName:D.Level})}removeEntity(s){const e=[...this.game.view.layers[this.layerName].entities].reverse().find(o=>{if(o.instance instanceof te&&o.instance.indicatorName===s)return!0}),t=e==null?void 0:e.instance;t instanceof te&&t.indicatorName===s&&(this.game.view.eraseFromLayer(t,this.layerName),this.game.view.removeEntityFromLayer(t,this.layerName))}renderElement(s){const e=new te(s);return this.game.view.add(e),e.render(),e}}class Rt{constructor(){r(this,"loopTimeMs",16);r(this,"loopCount",0);r(this,"loopDelays",{});r(this,"loopIntervals",{});r(this,"loopEntities",new Set);r(this,"active",!1);r(this,"lastTimestamp",0)}load(){this.start()}unload(){this.stop(),this.reset()}reset(){this.clearLoopEntities(),this.loopIntervals={},this.clearLoopDelays()}start(){this.active=!0,this.loop()}stop(){this.active=!1}add(s){if(this.registerTimerHandlers(s),s instanceof _)this.loopEntities.add(s);else if(s instanceof V){const e=Array.from(this.loopEntities);e.unshift(s),this.loopEntities=new Set(e)}}clearLoopEntities(){for(const s of this.loopEntities)s.despawn();this.loopEntities=new Set}loop(s=0){if(!!this.active){if(s&&s-this.lastTimestamp>=this.loopTimeMs){++this.loopCount,this.checkLoopDelays(),this.checkLoopIntervals();for(const t of this.loopEntities)t.update(),t.shouldBeDestroyed&&this.loopEntities.delete(t);this.lastTimestamp=s}requestAnimationFrame(this.loop.bind(this))}}convertTimeToLoops(s){return Math.floor(s/this.loopTimeMs)}setLoopDelay(s,e){let t=this.loopCount+this.convertTimeToLoops(e);t===this.loopCount&&++t,this.loopDelays[t]||(this.loopDelays[t]=[]),this.loopDelays[t].push(s)}clearLoopDelays(){this.loopCount=0,this.loopDelays={}}setLoopInterval(s,e,t){return this.loopIntervals[t]={loopCounter:0,targetLoop:this.convertTimeToLoops(e),callback:s},t}clearLoopInterval(s){s in this.loopIntervals&&delete this.loopIntervals[s]}registerTimerHandlers(s){s.on(h.SetLoopDelay,this.setLoopDelay.bind(this)),s.on(h.SetLoopInterval,this.setLoopInterval.bind(this)),s.on(h.ClearLoopInterval,this.clearLoopInterval.bind(this))}checkLoopDelays(){if(this.loopDelays[this.loopCount]){const s=this.loopDelays[this.loopCount];for(const e of s)e();delete this.loopDelays[this.loopCount]}}checkLoopIntervals(){Object.values(this.loopIntervals).forEach(s=>{if(s.loopCounter===s.targetLoop){s.callback(),s.loopCounter=0;return}s.loopCounter++})}}var T=(i=>(i[i.Blank=0]="Blank",i[i.Forest=11]="Forest",i[i.Ice=12]="Ice",i[i.Water=13]="Water",i[i.Base=15]="Base",i[i.Brick=1]="Brick",i[i.BrickTop=2]="BrickTop",i[i.BrickRight=3]="BrickRight",i[i.BrickBottom=4]="BrickBottom",i[i.BrickLeft=5]="BrickLeft",i[i.BrickBottomLeft=17]="BrickBottomLeft",i[i.BrickBottomRight=18]="BrickBottomRight",i[i.Concrete=6]="Concrete",i[i.ConcreteTop=7]="ConcreteTop",i[i.ConcreteRight=8]="ConcreteRight",i[i.ConcreteBottom=9]="ConcreteBottom",i[i.ConcreteLeft=10]="ConcreteLeft",i[i.ConcreteBottomLeft=19]="ConcreteBottomLeft",i[i.ConcreteBottomRight=20]="ConcreteBottomRight",i))(T||{});const Bt=[6,7,8,9,10,19,20],xt=[1,2,3,4,5,17,18],j={0:[0,6,12],12:[4,8]},It=["aaaaaaaaaaaaaaaaaabb","aaaaabaaabaaabaabdad","aaaaabaaabaaabaabdad","acbacbcbccbccdccbcdd","aabcabaabcaacbacbdcd","aabcacacacabadcacacd","aabaacbacacaacbacabc","cacacbaacbaacbdacbcd","cabaabacdacbacdcbcdc","aabacaadabcaaacaacad","bcbdbbdcbdbcbdbbdcbd","cbbcddcbdcbdcbdcbcdc","cbbbcdbcbdcbdcbcbcdc","bccbcbccbdcdcdcdcdcd","badbabdbbdbbdbdbdbdd","aaabaaaabaaadaaaaaad","aadbdadadadbdadadadd","cbacbabcbdcbbcdbcdbd","abcdabcdabcdabcddddd","abcdcdcdcdabcdcdcdcd","cabcacacdcabcdacdacd","abcabdabadbcabbdabbd","cbbbcbbdbbdcbdbdbdcd","abcaacbaaabcaacbdaad","bbdbddbcdbdbdcbddbdd","abcdcdabcdabcdabcdbd","acdcdcdcdacdcdbcdbcd","aaaaaaaaaaababaadcac","bcbdccbdccdcdbcdcccd","babcbdbabbcbdbabbcdb","bcdbbcdbcbdbcdbbcdcd","cabdaadbadadbdadbdcd","cbbdcbdbcdbbdcddbdbd","bbcbcbbbdbdbcdbdbdcd","cbdbdbdbdbddbcddcdcd"],ze=[[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,6,1,0,1,0,1,0],[0,1,0,1,0,2,0,2,0,1,0,1,0],[0,2,0,2,0,4,0,4,0,2,0,2,0],[4,0,4,4,0,2,0,2,0,4,4,0,4],[7,0,2,2,0,4,0,4,0,2,2,0,7],[0,4,0,4,0,1,1,1,0,4,0,4,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,2,0,2,0,1,0,1,0],[0,1,0,1,0,18,4,17,0,1,0,1,0],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,6,0,0,0,6,0,0,0,0,0],[0,1,0,6,0,0,0,1,0,1,0,1,0],[0,1,0,0,0,0,1,1,0,1,6,1,0],[0,0,0,1,0,0,0,0,0,6,0,0,0],[11,0,0,1,0,0,6,0,0,1,11,1,6],[11,11,0,0,0,1,0,0,6,0,11,0,0],[0,1,1,1,11,11,11,6,0,0,11,1,0],[0,0,0,6,11,1,0,1,0,1,0,1,0],[6,1,0,6,0,1,0,1,0,1,6,1,0],[0,1,0,1,0,1,1,1,0,1,6,1,0],[0,1,0,1,0,1,1,1,0,0,0,0,0],[0,1,0,0,0,18,4,17,0,1,0,1,0],[0,1,0,1,0,3,15,5,0,1,1,1,0]],[[0,0,0,0,1,0,0,1,0,0,0,0,0],[0,11,11,11,1,0,0,0,0,0,9,9,9],[1,11,11,11,0,0,0,0,0,0,0,0,0],[11,11,11,11,0,0,0,1,0,1,1,1,5],[11,11,11,11,1,1,1,2,0,1,0,3,0],[11,11,11,11,0,0,1,0,0,0,0,3,0],[0,11,0,0,0,0,6,6,6,0,0,11,0],[0,4,0,4,0,0,0,0,0,11,11,11,11],[1,5,3,1,5,3,2,2,2,11,11,11,11],[0,0,0,0,0,1,0,4,4,11,11,11,11],[1,0,0,10,0,0,0,2,2,11,11,11,0],[1,1,0,10,0,18,4,17,0,11,11,11,0],[6,1,1,0,0,3,15,5,0,1,0,0,0]],[[0,11,11,0,0,0,0,0,0,0,0,11,0],[11,11,0,0,4,1,1,4,4,0,0,0,11],[11,0,0,3,1,1,1,1,1,1,4,0,7],[7,0,0,1,1,1,1,1,1,1,1,5,0],[0,0,3,2,0,0,0,2,1,1,0,5,0],[13,0,3,0,10,0,10,0,1,5,0,0,0],[0,0,1,0,4,4,0,0,1,5,0,13,13],[0,0,1,1,1,1,1,1,1,1,0,0,0],[0,3,1,1,1,1,1,1,1,1,5,0,0],[0,2,2,1,1,1,1,1,1,2,2,0,0],[0,1,1,4,2,1,1,2,4,1,1,0,11],[11,0,2,2,0,18,4,17,2,2,0,11,11],[6,11,0,0,0,3,15,5,0,0,11,11,6]],[[0,0,0,0,1,1,0,0,0,0,0,0,0],[9,0,4,0,1,0,0,0,7,7,6,0,0],[6,0,1,0,0,0,1,0,0,0,0,0,0],[1,0,1,1,1,0,1,1,0,13,13,0,13],[2,0,0,0,2,0,0,0,0,13,0,0,0],[0,0,4,0,13,13,0,13,13,13,0,1,1],[1,1,0,0,13,1,0,1,5,0,0,0,0],[0,0,0,0,13,0,0,0,0,0,8,10,0],[13,13,13,0,13,0,6,0,1,0,8,0,0],[0,0,0,4,4,0,0,0,0,0,8,1,1],[0,0,0,0,1,2,2,2,1,4,0,0,0],[1,1,2,0,0,18,4,17,0,2,1,0,0],[2,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,3,0,5,11,11,0,0,0],[0,5,8,0,5,0,0,0,3,11,5,3,11],[0,5,8,0,5,0,1,0,3,11,5,3,11],[0,1,0,0,1,0,6,0,1,11,0,1,11],[0,0,0,3,7,0,1,0,2,10,0,11,11],[1,1,5,0,0,11,1,11,0,0,3,1,1],[0,0,0,0,3,11,11,11,5,0,0,0,0],[6,1,1,0,2,11,11,11,2,3,1,1,6],[7,7,7,0,4,0,11,0,4,0,7,7,7],[0,1,0,0,1,0,0,0,1,0,0,0,0],[0,1,5,0,0,2,0,2,0,0,0,0,11],[0,0,2,0,0,18,4,17,0,0,11,11,11],[0,0,4,0,0,3,15,5,0,0,4,11,11]],[[0,0,0,0,0,0,0,7,7,0,0,0,0],[0,0,6,7,7,7,0,0,0,0,6,0,0],[0,0,6,0,0,0,11,0,7,6,6,0,0],[0,6,0,0,0,11,6,0,0,0,6,0,0],[0,0,0,0,11,6,6,0,0,0,7,6,0],[0,6,0,11,6,6,6,0,6,0,0,0,0],[0,8,0,6,6,0,0,0,6,6,0,0,0],[10,0,0,0,6,0,6,6,6,0,0,8,0],[0,8,6,0,0,0,6,6,11,0,0,6,0],[0,6,0,0,0,0,6,11,0,0,6,6,0],[0,7,7,6,0,0,11,0,0,6,0,0,0],[0,0,0,0,0,18,4,17,0,7,0,9,6],[9,9,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,1,0,0,1,0,4,0,1,0,0,0],[11,1,1,1,0,1,0,9,0,1,5,0,0],[11,11,11,0,0,2,0,1,0,2,0,3,5],[11,13,13,13,13,13,13,13,13,13,13,0,13],[0,1,0,0,0,0,4,4,0,0,0,0,0],[0,0,1,0,0,3,1,1,2,1,2,7,7],[1,1,0,1,0,3,1,1,11,1,9,9,1],[0,0,0,6,0,9,0,11,11,11,11,0,0],[13,13,0,13,13,13,13,13,0,13,13,13,13],[11,11,0,3,0,0,4,4,0,0,0,0,0],[11,11,1,0,3,0,0,3,0,9,4,1,0],[11,9,1,0,3,18,4,17,0,2,0,1,0],[0,0,0,0,0,3,15,5,0,4,0,2,0]],[[0,0,0,1,0,0,0,0,0,9,11,0,0],[1,0,0,0,0,0,9,11,8,6,10,0,1],[0,0,0,9,11,8,6,10,0,7,0,0,0],[0,0,8,6,10,0,7,0,0,0,0,0,0],[0,0,0,7,11,0,0,0,0,0,0,0,0],[0,0,0,11,9,11,0,11,9,11,0,0,0],[6,1,0,8,6,10,0,8,6,10,0,1,6],[0,0,0,11,7,11,0,11,7,11,0,0,0],[0,0,0,0,9,0,0,0,9,0,0,0,0],[1,0,0,8,6,10,0,8,6,10,0,0,1],[1,0,0,11,7,11,0,11,7,11,0,0,1],[0,0,4,0,0,18,4,17,0,0,4,0,0],[0,0,1,1,0,3,15,5,0,1,1,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,3,2,1,0,0,0,0,0,0,1,2,5],[3,2,0,0,1,0,11,11,0,1,0,0,3],[1,0,0,0,1,11,11,11,11,1,0,0,3],[1,0,0,3,1,11,6,6,11,1,5,0,1],[3,4,4,1,13,13,13,13,13,13,1,1,1],[0,1,1,1,6,6,1,6,6,1,1,1,5],[0,0,1,1,6,0,1,0,6,1,1,5,0],[0,0,1,1,1,1,1,1,1,1,1,5,0],[1,11,2,2,2,6,6,2,2,2,2,11,1],[1,11,11,11,11,11,11,11,11,11,11,11,1],[0,0,11,11,11,18,4,17,11,11,11,11,0],[0,0,0,5,0,3,15,5,0,0,5,0,0]],[[0,0,0,0,0,6,0,1,0,1,1,0,0],[0,3,1,1,1,1,0,1,0,0,0,0,0],[0,0,0,5,0,1,0,1,1,0,11,11,11],[0,3,0,0,0,0,0,6,0,11,11,11,11],[0,3,0,1,1,1,6,1,1,11,11,2,6],[0,2,2,2,6,0,0,1,0,11,11,0,3],[3,1,1,1,0,6,11,11,11,11,11,0,0],[0,0,0,6,0,0,11,11,11,11,11,1,0],[6,1,0,11,11,11,11,6,11,11,11,1,0],[3,1,11,11,11,11,11,0,0,0,0,1,5],[0,1,11,11,0,0,0,0,7,1,1,1,0],[0,0,11,11,0,18,4,17,0,1,0,3,0],[0,4,11,11,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,0,0,1,1,1,0,0,0],[0,1,1,1,4,0,4,0,0,1,0,0,0],[0,0,0,0,1,0,2,0,0,0,0,1,1],[0,13,13,13,13,13,0,1,5,0,0,1,7],[0,0,9,9,9,13,0,1,0,6,10,1,0],[1,0,1,1,1,13,13,13,0,13,1,1,0],[0,0,0,0,6,13,0,0,0,13,7,0,0],[13,13,13,0,13,13,1,1,0,13,0,0,0],[0,0,0,0,0,1,7,7,0,13,13,13,0],[1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,7,7,0,0,0,1,1,0,3],[1,0,0,0,0,18,4,17,0,1,0,0,1],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,4,0,0,0,4,0,0,0,0],[0,1,1,1,1,0,0,0,1,1,1,1,0],[0,1,0,0,0,0,1,0,0,0,0,6,0],[0,6,0,1,2,0,0,0,2,1,0,1,1],[0,1,0,5,11,9,6,9,11,3,0,6,1],[0,2,0,0,11,11,11,11,11,0,0,7,1],[1,9,0,0,11,11,11,11,11,0,0,4,1],[1,6,0,5,11,7,6,7,11,3,0,1,0],[1,1,0,1,4,0,0,0,4,1,0,6,0],[1,6,0,0,0,0,1,0,0,0,0,1,0],[1,1,1,1,1,0,0,0,1,1,1,6,6],[1,1,0,0,2,18,4,17,2,0,0,1,0],[1,1,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[11,11,0,0,4,1,1,1,4,0,0,11,11],[11,0,0,3,1,1,1,1,1,5,0,0,11],[0,0,0,1,1,11,1,11,1,1,0,0,0],[0,0,0,1,11,11,1,11,11,1,0,0,0],[11,0,0,1,1,1,1,1,1,1,0,0,11],[11,11,0,0,1,11,1,11,1,0,0,11,11],[13,13,13,0,1,1,1,1,1,0,13,13,13],[0,0,0,0,3,3,3,3,3,0,0,0,0],[0,0,0,0,5,5,5,5,5,0,0,0,0],[8,8,8,0,0,0,0,0,0,0,10,10,10],[5,5,5,0,0,18,4,17,0,0,3,3,3],[10,10,10,8,0,3,15,5,0,10,8,8,8]],[[0,0,0,0,1,1,0,0,1,0,0,0,0],[0,11,11,1,1,0,0,0,1,0,0,0,0],[11,11,11,11,11,11,11,11,1,1,0,0,0],[11,7,1,11,1,1,1,11,11,11,11,1,6],[11,11,1,11,11,11,7,11,11,1,10,1,0],[0,11,11,1,9,11,11,11,11,1,0,1,0],[0,1,1,1,1,1,11,11,1,1,5,11,11],[8,7,1,1,11,0,0,1,2,0,0,0,11],[0,1,0,1,11,9,4,2,11,11,1,5,11],[0,1,0,0,3,1,2,11,11,1,0,0,11],[0,1,1,5,3,2,11,11,4,11,1,11,11],[0,0,1,0,11,18,4,17,1,11,2,11,0],[0,0,2,0,0,3,15,5,0,11,11,11,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,11,6,0,0,0,0,0,0,0,0],[0,0,0,11,0,11,9,0,0,0,0,0,0],[0,11,0,0,0,0,11,4,0,0,0,0,0],[0,11,11,0,0,11,0,11,9,0,0,0,0],[0,11,0,11,0,11,0,0,11,4,0,0,0],[0,11,0,0,11,0,0,0,11,11,9,0,0],[0,0,11,0,0,0,0,11,11,11,11,4,0],[0,0,0,11,0,0,11,0,11,11,11,11,0],[1,0,0,0,0,0,11,0,0,11,11,11,6],[1,1,0,0,0,0,0,11,0,11,11,11,11],[6,1,1,0,0,18,4,17,11,0,11,11,11],[6,6,1,1,0,3,15,5,11,0,0,11,11]],[[0,0,0,0,4,0,0,0,0,0,4,0,0],[0,1,0,1,1,0,0,12,12,12,1,1,0],[0,1,0,0,1,0,6,12,12,12,12,12,0],[12,12,12,10,1,0,0,1,12,12,12,12,0],[12,12,12,12,12,12,1,1,3,5,0,0,0],[0,0,8,12,12,12,12,1,3,5,0,7,7],[1,1,1,1,12,12,12,12,12,12,12,1,1],[0,0,0,1,1,12,12,12,12,10,0,0,0],[0,1,1,1,0,12,12,12,1,1,0,1,0],[12,12,12,1,12,0,0,0,0,1,0,1,0],[12,12,12,12,12,7,0,7,0,0,4,1,0],[1,12,12,12,12,18,4,17,0,1,0,0,0],[1,1,10,0,0,3,15,5,0,1,0,1,0]],[[0,0,0,0,0,0,0,0,6,6,6,11,0],[0,1,0,0,0,0,0,0,6,0,0,6,0],[1,11,1,0,0,0,1,1,1,1,0,6,0],[0,1,11,1,0,0,1,0,11,1,6,6,0],[0,0,1,0,11,6,1,11,0,1,0,0,0],[0,0,0,0,6,0,1,6,1,1,0,0,0],[0,0,1,1,6,1,0,6,0,0,0,0,0],[0,0,1,0,11,1,6,11,0,0,0,0,0],[6,6,6,11,0,1,0,0,1,1,0,0,0],[6,0,1,1,1,1,0,0,1,6,6,0,0],[6,0,0,6,0,0,0,0,0,6,1,1,0],[11,6,6,6,0,18,4,17,0,0,1,6,6],[0,0,0,0,0,3,15,5,0,0,0,6,6]],[[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,7,0,7,0,7,0,7,0,7,0,7,0],[4,0,4,0,1,0,0,0,1,0,4,0,4],[1,0,1,2,1,0,1,0,1,2,1,0,1],[7,0,7,0,6,0,7,0,6,0,7,0,7],[11,11,0,0,1,0,11,0,1,0,0,11,11],[11,11,11,11,1,2,11,2,1,11,11,11,11],[11,11,11,11,11,11,11,11,11,11,11,11,11],[4,0,4,0,1,11,11,11,1,0,4,0,4],[0,1,0,1,0,0,11,0,0,1,0,1,0],[0,1,0,1,0,18,4,17,0,1,0,1,0],[0,2,0,2,0,3,15,5,0,2,0,2,0]],[[0,0,0,13,0,1,0,0,1,0,1,0,0],[0,0,0,0,0,0,0,0,1,0,6,0,0],[0,0,0,13,0,4,6,0,1,0,1,0,0],[7,0,1,13,0,6,0,4,2,0,1,0,0],[0,0,1,13,0,0,0,1,0,0,0,0,0],[1,0,1,13,13,0,13,13,13,13,0,0,1],[0,0,0,4,0,0,0,11,0,13,0,7,7],[1,1,3,1,0,6,11,11,11,13,0,4,4],[2,0,3,0,0,1,11,11,11,13,0,1,0],[0,9,0,0,0,1,0,11,0,13,0,11,0],[0,1,0,9,0,2,2,2,0,0,11,11,11],[0,1,0,1,0,18,4,17,0,13,11,11,11],[0,0,0,0,0,3,15,5,0,13,0,11,0]],[[0,0,0,4,4,4,0,0,4,0,0,0,0],[0,4,1,1,1,1,1,1,1,1,0,0,0],[0,11,11,11,11,11,11,11,11,1,1,0,0],[11,11,0,0,0,0,0,0,11,11,1,1,0],[11,0,6,0,0,6,0,0,0,11,11,11,0],[11,0,6,0,0,6,0,0,0,11,11,11,0],[11,0,0,11,0,0,0,0,11,11,1,1,5],[11,11,11,11,11,11,11,11,11,1,1,1,5],[1,11,11,1,1,11,11,11,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,0,6],[6,0,1,6,1,1,1,1,1,1,5,0,6],[0,6,1,2,6,18,4,17,1,1,6,6,6],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,11,0,0,0,0,0,0,0],[0,0,0,0,11,6,11,0,0,0,0,0,0],[0,0,11,0,0,11,0,0,11,11,0,0,0],[0,11,1,11,0,0,0,11,1,1,11,0,0],[0,0,11,1,11,0,0,0,11,11,0,0,11],[11,0,0,11,0,0,11,0,0,0,0,11,6],[1,11,0,0,0,11,6,11,0,0,11,0,11],[6,1,11,0,0,0,11,0,0,11,6,11,0],[1,11,0,0,11,0,0,0,11,0,11,0,0],[11,0,0,11,1,11,0,11,1,11,0,0,0],[0,0,0,11,1,11,0,0,11,0,0,11,0],[0,11,0,0,11,18,4,17,0,0,11,6,11],[11,6,11,0,0,3,15,5,0,11,1,11,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,6,6,0,0,0,0,0,0],[0,0,0,0,0,0,6,0,0,0,0,0,0],[0,6,6,11,11,1,6,1,11,11,6,6,0],[0,0,0,6,11,11,6,11,11,6,0,0,0],[11,0,0,0,6,11,11,11,6,0,0,0,11],[6,11,0,0,0,11,11,11,0,0,0,11,6],[11,0,0,0,9,7,11,7,9,0,0,0,11],[0,0,0,0,6,0,9,0,6,0,0,0,0],[0,0,0,6,0,0,6,0,0,6,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,18,4,17,0,0,0,0,0],[0,0,6,0,0,3,15,5,0,0,6,0,0]],[[0,0,6,0,1,7,0,0,0,0,3,0,0],[0,0,1,0,1,11,0,2,1,1,1,0,0],[0,11,11,0,1,11,3,5,0,0,0,6,6],[11,11,11,11,11,11,1,1,1,0,3,1,0],[0,0,11,11,4,4,7,1,0,3,1,2,3],[1,7,0,4,2,2,0,0,0,1,2,0,3],[3,0,4,1,12,12,12,12,12,12,12,12,12],[3,0,2,0,12,12,12,12,12,12,12,12,12],[0,0,6,0,12,12,12,12,12,12,12,12,12],[1,0,1,0,12,12,12,12,12,12,12,12,12],[3,0,1,0,12,12,12,12,12,12,12,12,12],[3,0,1,0,0,18,4,17,12,12,12,12,12],[0,0,2,0,0,3,15,5,0,12,12,12,12]],[[0,0,0,6,0,1,0,1,0,1,0,6,0],[0,1,0,1,0,0,0,0,0,6,0,0,0],[0,1,0,1,0,0,6,0,0,6,0,6,6],[0,1,0,0,0,1,0,6,1,0,0,0,6],[0,0,0,0,1,1,0,1,1,0,6,0,0],[0,0,6,0,1,0,0,1,1,0,1,1,0],[6,0,6,0,0,1,0,6,0,0,6,1,0],[0,0,1,1,0,1,0,0,0,1,6,0,0],[0,6,1,1,0,1,1,0,1,1,0,0,1],[0,1,0,0,0,1,6,0,0,0,0,1,1],[0,0,0,1,0,1,1,6,0,6,0,0,1],[1,0,1,1,0,18,4,17,0,1,6,0,0],[1,0,1,0,0,3,15,5,0,1,1,1,0]],[[0,0,13,13,0,0,0,0,0,0,0,0,0],[9,0,0,13,11,0,5,0,0,0,0,0,0],[11,9,0,0,0,0,10,0,5,0,13,13,0],[11,11,0,7,4,3,0,0,10,11,13,0,0],[11,11,11,0,0,6,4,3,0,0,0,0,9],[11,11,7,9,0,3,0,6,4,0,0,9,11],[11,7,0,0,2,6,0,3,0,7,0,11,11],[0,0,0,0,0,5,2,6,0,0,11,11,11],[0,0,13,11,8,0,0,5,2,9,7,11,11],[0,13,13,0,3,0,8,0,0,0,0,0,11],[0,0,0,0,0,0,3,0,11,13,0,0,7],[6,0,0,0,0,18,4,17,0,13,13,0,0],[0,0,0,0,0,3,15,5,0,0,0,0,6]],[[0,0,0,0,6,0,0,0,0,0,0,0,0],[6,6,0,0,6,0,0,6,6,0,0,0,0],[0,6,0,0,6,0,0,0,6,0,6,6,11],[0,6,0,0,6,6,6,0,11,0,6,0,0],[0,1,0,0,0,0,6,0,6,6,6,0,0],[11,6,6,0,6,1,6,1,1,0,0,0,0],[0,0,6,11,6,11,0,0,1,0,0,6,6],[0,0,6,0,0,11,0,0,6,0,0,6,0],[0,0,1,0,0,6,0,0,6,6,1,6,0],[11,6,6,6,11,11,1,6,6,0,1,6,0],[0,0,0,1,0,0,0,0,11,11,0,1,0],[0,0,0,6,0,18,4,17,0,11,0,1,0],[0,0,0,6,0,3,15,5,0,6,0,1,0]],[[0,0,0,0,0,0,0,0,0,0,8,10,0],[0,0,0,0,0,0,9,0,0,0,6,0,0],[0,0,0,0,0,4,11,4,0,1,5,0,0],[0,0,0,0,9,11,11,11,9,1,5,0,0],[0,0,0,4,11,11,12,11,11,1,5,0,0],[0,0,9,11,11,12,12,12,11,11,5,0,0],[0,4,11,11,12,12,12,12,12,11,11,4,0],[9,11,11,12,12,12,12,12,12,12,11,11,9],[11,11,12,12,12,12,12,12,12,12,12,11,11],[0,11,12,12,12,12,12,12,12,12,12,11,0],[0,11,12,12,12,12,12,12,12,12,12,11,0],[0,11,12,12,12,18,4,17,12,12,12,11,0],[0,11,12,12,0,3,15,5,0,12,12,11,0]],[[0,0,0,0,0,0,0,0,0,0,1,0,0],[0,1,13,13,0,6,0,1,0,0,0,0,0],[0,0,13,13,1,11,11,11,13,13,0,6,0],[0,0,0,0,0,11,11,11,13,13,1,0,0],[0,6,0,0,13,13,0,11,0,0,0,0,0],[11,11,1,0,13,13,6,0,0,0,0,1,0],[11,11,11,0,0,0,0,0,0,6,0,0,6],[0,1,13,13,0,1,0,0,0,0,0,0,0],[6,0,13,13,11,11,13,13,11,11,0,1,0],[0,0,0,0,11,0,13,13,11,11,13,13,0],[0,0,0,6,11,0,0,0,11,11,13,13,0],[0,0,1,0,1,18,4,17,0,0,0,0,0],[1,0,0,0,0,3,15,5,0,1,6,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,4,0,0,0,9,0,0],[0,9,9,0,4,11,11,9,0,4,11,4,0],[4,11,11,4,11,11,11,11,4,11,11,11,4],[11,11,11,11,11,11,11,11,11,11,11,11,11],[6,11,13,11,11,11,11,11,13,11,11,11,11],[11,11,13,13,13,11,11,11,13,13,13,11,6],[11,11,11,11,13,11,6,11,11,11,13,11,11],[11,11,11,11,11,11,11,11,11,11,11,11,11],[11,11,11,11,11,2,2,11,11,11,11,11,7],[7,11,11,11,2,0,0,2,11,11,11,7,0],[0,7,2,2,0,18,4,17,2,2,2,0,0],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,13,0,0,0,0,13,0,0,0,0],[13,13,0,13,0,13,13,13,13,0,13,13,13],[11,11,1,0,0,1,0,0,13,0,13,11,13],[11,13,13,13,13,0,6,0,0,1,11,11,11],[11,11,0,13,0,0,13,0,13,13,13,13,11],[13,13,0,13,0,13,13,0,0,13,0,0,0],[0,0,1,11,1,0,1,11,0,13,0,0,13],[0,13,13,11,13,13,13,13,0,11,1,0,13],[1,0,0,1,0,0,13,0,11,11,13,0,13],[13,13,0,13,13,0,13,1,13,13,13,0,0],[0,0,1,0,11,11,0,0,11,13,0,0,13],[0,13,13,13,11,18,4,17,0,13,0,13,13],[0,13,0,0,0,3,15,5,0,0,0,0,0]],[[12,12,12,12,12,12,12,12,12,12,12,12,12],[12,12,12,12,12,12,12,12,12,12,12,12,12],[12,12,12,1,12,12,12,12,12,1,12,12,12],[12,1,0,1,0,1,12,1,0,1,0,1,12],[12,2,2,1,0,0,0,0,0,1,2,2,12],[12,12,12,1,4,1,6,1,4,1,12,12,12],[6,12,12,12,0,7,0,7,0,12,12,12,6],[12,12,12,12,0,4,0,4,0,12,12,12,12],[12,12,12,12,0,1,0,1,0,12,12,12,12],[12,12,12,1,0,0,4,0,0,1,12,12,12],[12,1,12,1,0,7,7,7,0,1,12,1,12],[0,1,4,1,0,18,4,17,0,1,4,1,0],[0,2,0,0,0,3,15,5,0,0,0,2,0]],[[0,0,0,0,6,0,0,0,0,6,0,0,0],[0,6,0,0,0,6,0,0,6,11,11,0,0],[0,0,6,0,0,0,0,6,11,9,10,0,0],[0,0,0,6,0,11,11,11,11,11,0,8,0],[0,10,0,0,6,11,11,6,11,0,0,6,0],[0,7,10,11,0,6,11,11,6,0,0,8,0],[0,0,11,11,11,11,11,0,0,6,0,0,0],[0,9,10,11,0,6,11,0,0,0,6,0,0],[0,11,11,11,6,0,6,0,9,0,0,6,0],[11,11,11,6,0,0,0,0,8,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,8,6],[0,0,0,0,0,18,4,17,0,9,10,0,0],[10,0,9,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,5,3,0,0,0,0,0,0,0],[5,5,5,3,0,5,0,0,5,5,0,0,0],[5,5,5,1,1,0,0,0,5,1,5,0,0],[3,3,0,1,5,0,0,3,5,1,1,0,0],[0,5,0,1,3,5,0,5,1,1,1,0,0],[0,5,3,0,0,1,5,1,3,3,1,0,0],[0,5,0,0,3,1,1,5,0,5,1,0,0],[0,3,0,0,5,1,1,5,0,5,1,0,0],[0,3,2,2,0,1,1,1,0,5,5,2,1],[0,3,0,0,3,5,1,3,5,5,5,3,3],[0,0,5,0,1,3,5,1,1,0,0,3,0],[0,0,5,3,5,18,4,17,1,5,0,5,0],[0,0,5,3,0,3,15,5,0,1,1,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,0,1,0,0,0,0,0,0],[11,0,0,11,1,11,1,11,0,0,11,0,0],[1,11,11,1,1,1,1,1,11,11,1,11,0],[1,1,1,1,6,1,6,1,1,1,1,11,0],[13,13,13,1,1,1,1,1,13,13,13,11,0],[13,1,1,1,1,1,1,1,1,1,13,13,11],[1,1,1,13,1,1,1,13,1,1,1,11,11],[1,1,13,13,13,1,13,13,13,1,1,13,13],[11,13,13,11,11,11,11,11,13,13,11,13,11],[0,11,11,0,0,0,0,0,11,11,0,11,0],[0,0,0,0,0,18,4,17,0,0,0,0,0],[0,0,0,0,0,3,15,5,0,0,0,0,0]]];class Dt{constructor(s){r(this,"map",null);r(this,"mapLevelIndex",0);r(this,"mapTerrainData",ze);r(this,"mapEnemyForces",It);this.game=s,this.mapLevelIndex=this.game.state.level-1}fixMapData(s){return this.clearSpawnPlaces(s),s}coordToPos(s){return s*4+this.game.state.boundarySize}coordsToRect(s,e){return{posX:this.coordToPos(s),posY:this.coordToPos(e)}}getMap(){return this.map=this.fixMapData(this.mapTerrainData[this.mapLevelIndex]),this.map}getRandomEmptyCell(){if(!this.map)return this.coordsToRect(0,0);let s,e=0,t=0;const o=this.map.length-1,a=this.map[0].length-1;do e=$(0,a),t=$(0,o),s=this.map[e][t];while(s!==T.Blank||j[e]&&j[e].includes(t));return this.coordsToRect(t,e)}getMapTankEnemyVariant(s){switch(this.mapEnemyForces[this.mapLevelIndex][s]){case"b":return"FAST";case"c":return"POWER";case"d":return"ARMOR";default:return"BASIC"}}mapDataToEntitySettings(s){const e=[];return s.forEach((t,o)=>{t.forEach((a,n)=>{const l=this.cellToEntitySettings(a,n,o);!l||e.push(l)})}),e}cellToEntitySettings(s,e,t){let o=null;if(Bt.includes(s))o="concreteWall";else if(xt.includes(s))o="brickWall";else if(s===T.Forest)o="trees";else if(s===T.Water)o="water";else if(s===T.Ice)o="ice";else if(s===T.Base)o="flag";else return;const a={type:o,width:4,height:4,posX:this.coordToPos(e),posY:this.coordToPos(t)};return(a.type==="brickWall"||a.type==="concreteWall")&&this.updateWallProps(a,s),a}updateWallProps(s,e){if(!s.width||!s.height)return;const t=2;switch(e){case T.BrickTop:case T.ConcreteTop:s.variant="TOP",s.height-=t;break;case T.BrickBottom:case T.ConcreteBottom:s.variant="BOTTOM",s.posY+=t,s.height-=t;break;case T.BrickLeft:case T.ConcreteLeft:s.variant="LEFT",s.width-=t;break;case T.BrickRight:case T.ConcreteRight:s.variant="RIGHT",s.posX+=t,s.width-=t;break;case T.BrickBottomLeft:case T.ConcreteBottomLeft:s.variant="LEFT_BOTTOM",s.posY+=t,s.width-=t,s.height-=t;break;case T.BrickBottomRight:case T.ConcreteBottomRight:s.variant="RIGHT_BOTTOM",s.posX+=t,s.posY+=t,s.width-=t,s.height-=t;break;default:s.variant="WHOLE";break}}clearSpawnPlaces(s){for(const e in j)for(const t of j[e])s[e][t]=T.Blank}}class At extends A{constructor(e){super();r(this,"imageList",{});r(this,"soundList",{});r(this,"audioContext");this.game=e;const t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t}load(e=ht,t=this.game.state.loadResourcesTimeout){const o=setTimeout(()=>{alert(nt)},t);return Promise.all(Object.entries(e).map(a=>this.loadResource(a))).then(()=>(this.emit(q.Loaded),!0)).catch(()=>(this.emit(q.Error),alert(lt),!1)).finally(()=>clearTimeout(o))}getImage(e){return this.imageList[e]}getSound(e){return this.soundList[e]}loadResource(e){const[t,o]=e,a=this.getAssetType(o);return a==="image"?this.loadImgResource(t,o):a==="sound"?this.loadSoundResource(t,o):Promise.reject(new Error("Unknown asset type"))}loadImgResource(e,t){return new Promise((o,a)=>{const n=new Image;n.onload=()=>{this.imageList[e]=n,o(n)},n.onerror=()=>{a(new Error("Error loading image file"))},n.src=t})}loadSoundResource(e,t){return new Promise((o,a)=>{fetch(t).then(async n=>{var l;return(l=this.audioContext)==null?void 0:l.decodeAudioData(await n.arrayBuffer())}).then(n=>{this.soundList[e]=n,o(n)}).catch(()=>{a(new Error("Error loading audio file"))})})}getAssetType(e){var o;const t=(o=e.split(".").pop())!=null?o:"unknown";return Le.images.includes(t)?"image":Le.sounds.includes(t)?"sound":"unknown"}}var Y=(i=>(i.GameOver="GAME_OVER",i.MissionAccomplished="MISSION_ACCOMPLISHED",i))(Y||{});class Ct extends A{constructor(e){super();r(this,"mapManager");r(this,"indicatorManager");r(this,"activeEnemies",[]);r(this,"activePowerup",null);r(this,"maxTotalEnemies",20);r(this,"maxActiveEnemies",4);r(this,"enemiesSpawnDelay",1e3);r(this,"enemiesSpawnCounter",0);this.game=e,this.mapManager=new Dt(e),this.indicatorManager=new Mt(e),this.createTerrain(),this.createEnemies(),this.createPlayers()}createTerrain(){this.createBoundaries();const e=this.mapManager.getMap();this.mapManager.mapDataToEntitySettings(e).forEach(o=>{this.createEntity(o)})}createEntity(e){let t;e.type==="flag"?t=new ut(e).on(h.Destroyed,()=>{this.emit(Y.GameOver)}):t=new He(e),this.game.addEntity(t),t.spawn(e)}createBoundaries(){const e=this.game.state;this.createEntity({type:"boundary",width:e.width,height:e.boundarySize,posX:0,posY:0}),this.createEntity({type:"boundary",width:e.width,height:e.boundarySize,posX:0,posY:e.height-e.boundarySize}),this.createEntity({type:"boundary",width:e.boundarySize,height:e.height-e.boundarySize*2,posX:0,posY:e.boundarySize}),this.createEntity({type:"boundary",width:e.boundarySize+e.indicatorsSidebarSize,height:e.height-e.boundarySize*2,posX:e.width-e.boundarySize-e.indicatorsSidebarSize,posY:e.boundarySize})}createEnemies(){this.game.state.mode==="SINGLEPLAYER"?(this.maxTotalEnemies=this.game.state.singleplayerMaxTotalEnemies,this.maxActiveEnemies=this.game.state.singleplayerMaxActiveEnemies,this.enemiesSpawnDelay=this.game.state.singleplayerEnemiesSpawnDelay):this.game.state.mode==="MULTIPLAYER"&&(this.maxTotalEnemies=this.game.state.multiplayerMaxTotalEnemies,this.maxActiveEnemies=this.game.state.multiplayerMaxActiveEnemies,this.enemiesSpawnDelay=this.game.state.multiplayerEnemiesSpawnDelay),this.createTankEnemy(),this.game.loop.setLoopInterval(()=>{this.canCreateTankEnemy()&&this.createTankEnemy()},this.enemiesSpawnDelay,"SCENARIO_ENEMY_TANK_CREATION")}canCreateTankEnemy(){return this.activeEnemies.length<this.maxActiveEnemies&&this.enemiesSpawnCounter<this.maxTotalEnemies}createTankEnemy(){++this.enemiesSpawnCounter;const e=this.maxTotalEnemies-this.enemiesSpawnCounter;this.indicatorManager.renderTankEnemiesLeft(e);const t={variant:this.mapManager.getMapTankEnemyVariant(this.enemiesSpawnCounter),flashing:this.game.state.flashingEnemyTanksWithPowerups.includes(this.enemiesSpawnCounter),difficulty:this.game.state.difficulty};t.flashing&&this.activePowerup&&this.activePowerup.despawn();const o=new ge(t);this.game.addEntity(o),this.activeEnemies.push(o),o.on(h.Shoot,a=>{this.createProjectile(a)}).on(h.Destroyed,()=>{this.createExplosion(o),o.flashing&&this.createPowerup(),this.activeEnemies=this.activeEnemies.filter(a=>a!==o),!this.canCreateTankEnemy()&&this.activeEnemies.length===0&&this.emit(Y.MissionAccomplished)}),this.trySpawnTankEnemy(o)}trySpawnTankEnemy(e){const t=Math.floor(Math.random()*j[0].length),o=this.mapManager.coordsToRect(j[0][t],0);e.spawn(o)||this.game.loop.setLoopDelay(this.trySpawnTankEnemy.bind(this,e),this.game.state.tankRespawnRetryInterval)}createPlayers(){this.game.state.mode==="SINGLEPLAYER"?this.createPlayerTank(R.Player1):this.game.state.mode==="MULTIPLAYER"&&(this.createPlayerTank(R.Player1),this.createPlayerTank(R.Player2))}createPlayerTank(e=R.Player1){const t=Pt[e],o=this.getPlayerState(e);t.upgradeTier=o.upgradeTier;const a=new Z(t);this.game.addEntity(a),a.on(h.Spawn,()=>{this.indicatorManager.renderPlayerLives(e,o.lives)}).on(h.Shoot,l=>{this.createProjectile(l)}).on(h.Destroyed,()=>{this.createExplosion(a),o.upgradeTier=1,--o.lives;const l=this.game.state.playerOne.lives<0,m=this.game.state.mode==="SINGLEPLAYER"||this.game.state.playerTwo.lives<0;l&&m&&this.emit(Y.GameOver),o.lives>=0&&(this.indicatorManager.renderPlayerLives(e,o.lives),this.createPlayerTank(e))}),o.lives<0&&(o.lives=0),this.trySpawnTankPlayer(a),this.on(Y.GameOver,()=>{a&&a.spawned&&(a.frozen=!0,a.stop()),a.on(h.Ready,()=>{a.frozen=!0,a.stop()})}),this.getPlayerController(e).offAll(c.Move).on(c.Move,l=>{a.move(l)}).offAll(c.Stop).on(c.Stop,()=>{a.stop()}).offAll(c.Shoot).on(c.Shoot,()=>{!this.game.state.paused&&a.shoot()})}trySpawnTankPlayer(e){e.spawn(),e.spawned||this.game.loop.setLoopDelay(this.trySpawnTankPlayer.bind(this,e),this.game.state.tankRespawnRetryInterval)}getPlayerState(e){return e===R.Player1?this.game.state.playerOne:this.game.state.playerTwo}getPlayerController(e){if(this.game.state.mode==="MULTIPLAYER"){if(e===R.Player1)return this.game.controllerPlayerOne;if(e===R.Player2)return this.game.controllerPlayerTwo}return this.game.controllerAll}createProjectile(e){if(!e)return null;this.game.addEntity(e),e.spawn({posX:e.posX,posY:e.posY}),e.update(),e.on(h.Exploding,()=>{this.createExplosion(e)})}createExplosion(e){const t=new Ue({parent:e});this.game.addEntity(t),t.spawn()}createPowerup(){this.activePowerup&&this.activePowerup.despawn();const e=new re;this.game.addEntity(e);const t=this.mapManager.getRandomEmptyCell();e.spawn(t),this.activePowerup=e,e.on(h.Destroyed,()=>{const o=e.destroyedBy;if(!(o instanceof Z))return;const a=o.variant,n=this.getPlayerState(a);if(e.variant==="STAR"&&(++n.upgradeTier,o.upgrade()),e.variant==="HELMET"&&o.useShield(this.game.state.shieldPowerupDuration),e.variant==="TANK"&&n.lives<9&&(++n.lives,this.indicatorManager.renderPlayerLives(a,n.lives)),e.variant==="GRENADE"&&this.activeEnemies.forEach(l=>{l.beDestroyed(o)}),e.variant==="CLOCK"){const l="ENEMY_FREEZE_INTERVAL";let m=100;const y=Math.round(this.game.state.freezePowerupDuration/m),f=w=>{this.activeEnemies.forEach(I=>{I.frozen=w})};this.game.loop.clearLoopInterval(l),f(!0),this.game.loop.setLoopInterval(()=>{f(!0),--m<=0&&(this.game.loop.clearLoopInterval(l),f(!1))},y,l)}if(e.variant==="SHOVEL"){const l=[["BottomRight",11,5],["Bottom",11,6],["BottomLeft",11,7],["Right",12,5],["Left",12,7]],m=P=>{for(const[J,ue,be]of l){const Je=T[P+J],de=this.mapManager.cellToEntitySettings(Je,be,ue);!de||(this.game.zone.doAreaDamage(de,e),this.createEntity(de))}};m("Concrete");const y="REINFORCED_WALLS_INTERVAL_MAIN",f=this.game.state.wallsPowerupDuration,w="REINFORCED_WALLS_INTERVAL_FINISHING",I=200;let M=10;this.game.loop.clearLoopInterval(y),this.game.loop.clearLoopInterval(w),this.game.loop.setLoopInterval(()=>{this.game.loop.clearLoopInterval(y),this.game.loop.setLoopInterval(()=>{const P=--M%2===0;M<=0?this.game.loop.clearLoopInterval(w):m(P?"Concrete":"Brick")},I,w)},f,y)}})}}class Ot{constructor(){r(this,"inited",!1);r(this,"paused",!1);r(this,"debugging",!1);r(this,"level",1);r(this,"maxLevels",ze.length);r(this,"mode",E.Singleplayer);r(this,"difficulty",x.Hard);r(this,"themeName",localStorage.getItem(ve)||G.Classic);r(this,"joystickType",localStorage.getItem(ae)||ne.ButtonJoystick);r(this,"username","");r(this,"defaultPlayerLives",2);r(this,"defaultPlayerUpgradeTier",1);r(this,"playerOne",{lives:this.defaultPlayerLives,upgradeTier:this.defaultPlayerUpgradeTier});r(this,"playerTwo",{lives:this.defaultPlayerLives,upgradeTier:this.defaultPlayerUpgradeTier});r(this,"singleplayerMaxTotalEnemies",20);r(this,"singleplayerMaxActiveEnemies",4);r(this,"singleplayerEnemiesSpawnDelay",2e3);r(this,"multiplayerMaxTotalEnemies",20);r(this,"multiplayerMaxActiveEnemies",6);r(this,"multiplayerEnemiesSpawnDelay",1e3);r(this,"tankRespawnRetryInterval",200);r(this,"flashingEnemyTanksWithPowerups",[4,11,18]);r(this,"screen",S.Loading);r(this,"mainMenuItem",E.Singleplayer);r(this,"width",62);r(this,"height",56);r(this,"boundarySize",2);r(this,"indicatorsSidebarSize",6);r(this,"loadResourcesTimeout",6e4);r(this,"gameIntroPopupTimeout",2e3);r(this,"missionAccomplishedRedirectTimeout",1e3);r(this,"gameOverPopupTimeout",3e3);r(this,"scoreScreenTimeout",7e3);r(this,"wallsPowerupDuration",1e4);r(this,"shieldPowerupDuration",1e4);r(this,"freezePowerupDuration",1e4)}load(){this.inited=!0,this.paused=!1,this.playerOne={lives:this.defaultPlayerLives,upgradeTier:this.defaultPlayerUpgradeTier},this.playerTwo={lives:this.defaultPlayerLives,upgradeTier:this.defaultPlayerUpgradeTier}}unload(){this.inited=!1,this.paused=!1}reset(){this.paused=!1}resetSession(){this.unload(),this.load()}}class _t{constructor(s){r(this,"game");r(this,"mode","SINGLEPLAYER");r(this,"active",!1);r(this,"highestScore",2e4);r(this,"sessionScore",[0,0]);r(this,"sessionCompletedMaps",0);r(this,"sessionElapsedTime",0);r(this,"mapScore",[0,0]);r(this,"mapEnemiesKilledCount",{BASIC:[0,0],FAST:[0,0],POWER:[0,0],ARMOR:[0,0]});r(this,"mapElapsedTime",0);r(this,"mapStartTime",0);this.game=s}load(){this.sessionScore=[0,0],this.sessionCompletedMaps=0,this.sessionElapsedTime=0,this.reset()}unload(){this.finishSession(),this.reset()}reset(){this.mapScore=[0,0],this.mapEnemiesKilledCount={BASIC:[0,0],FAST:[0,0],POWER:[0,0],ARMOR:[0,0]},this.mapElapsedTime=0}recountScoreBasedOnDifficulty(s){return this.game.state.difficulty===x.Easy?s/2:s}sendRecord(){this.mode==="SINGLEPLAYER"&&this.game.updateLeaderboard({score:this.recountScoreBasedOnDifficulty(this.sessionScore[0]),matches:this.sessionCompletedMaps,time:this.sessionElapsedTime})}getCurrentStatistics(){const{mode:s,sessionScore:e,mapEnemiesKilledCount:t}=this,o={},a=[0,0];Object.entries(t).forEach(l=>{const m=l[0],[y,f]=l[1],w=this.recountScoreBasedOnDifficulty(this.getScoreByEnemyVariant(m));o[m]=[y*w,f*w],a[0]+=y,a[1]+=f});const n=[this.recountScoreBasedOnDifficulty(e[0]),this.recountScoreBasedOnDifficulty(e[1])];return{mode:s,sessionScore:n,mapEnemiesKilledScore:o,mapEnemiesKilledCount:t,mapEnemiesKilledTotal:a}}getScoreByEnemyVariant(s){switch(s){case"ARMOR":return 400;case"POWER":return 300;case"FAST":return 200;case"BASIC":return 100}}getPlayerIndex(s){return s==="PLAYER1"?0:1}add(s){const e=s instanceof re,t=s instanceof Ue&&s.parent instanceof ge;e&&s.on(h.Destroyed,()=>{this.createScore(s)}),t&&s.on(h.Despawn,()=>{this.createScore(s.parent)})}createScore(s){const e=this.countPoints(s),t=new dt({points:e,parent:s});this.game.addEntity(t),t.spawn()}countPoints(s){const e=s instanceof re,t=s instanceof ge;if(!e&&!t)return 0;let o;if(s.destroyedBy instanceof Z&&(o=s.destroyedBy),s.destroyedBy instanceof V&&s.destroyedBy.parent instanceof Z&&(o=s.destroyedBy.parent),!o)return 0;let a=0;e&&(a=500),t&&(a=this.getScoreByEnemyVariant(s.variant));const n=this.getPlayerIndex(o.variant);return this.sessionScore[n]+=a,this.mapScore[n]+=a,t&&++this.mapEnemiesKilledCount[s.variant][n],a}startSession(s){this.active||(this.active=!0,this.mode=s,this.load())}finishSession(){!this.active||(this.finishMap(!0),this.active=!1)}startMap(){this.startTimer()}finishMap(s=!1){this.stopTimer(),this.sessionElapsedTime+=this.mapElapsedTime,s||++this.sessionCompletedMaps,this.sendRecord()}startTimer(){this.mapStartTime=Date.now()}stopTimer(){this.mapElapsedTime+=Date.now()-this.mapStartTime}}class Ft extends A{constructor(e){var a;super();r(this,"width",0);r(this,"height",0);r(this,"pixelRatio",10);r(this,"gameBgColor",u.Black);r(this,"layerZIndexCount",0);r(this,"layers",{});r(this,"root");r(this,"floorLayer");r(this,"spriteImg",null);r(this,"canvasResizeListener",this.canvasResizeHandler.bind(this));r(this,"toggleFullscreenListener",()=>{this.emit(O.ToggleColorServiceBtn,N.Fullscreen)});this.game=e;const{width:t,height:o}=this.game.state;this.width=t,this.height=o,this.pixelRatio=this.getPixelRatio(),(a=this.game.resources)==null||a.on(q.Loaded,()=>{const n=H[this.game.state.themeName].spriteName;this.spriteImg=this.game.resources.getImage(n)})}toggleFullScreen(){var e;document.fullscreenElement?document.exitFullscreen():(e=document.querySelector(`.${v.FullscreenWrapper}`))==null||e.requestFullscreen()}reset(){for(const e of Object.keys(this.layers))this.eraseAllEntitiesOnLayer(e)}load(e){var t;if(e===null)throw new Error("proper DOM root for the game should be set");this.root=e,this.isRootEmpty()&&(this.floorLayer=this.createLayer("floor"),this.floorLayer.style.background=(t=H[this.game.state.themeName])==null?void 0:t.floorBg,this.createLayer("tanks"),this.createLayer("projectiles"),this.createLayer("ceiling"),this.createLayer("explosions"),this.createLayer("overlay").style.position="relative"),window.addEventListener("resize",this.canvasResizeListener),document.addEventListener("fullscreenchange",this.toggleFullscreenListener)}unload(){window.removeEventListener("resize",this.canvasResizeListener),document.removeEventListener("fullscreenchange",this.toggleFullscreenListener)}createLayer(e){const t=document.createElement("canvas");return t.id=e,t.width=this.convertToPixels(this.width),t.height=this.convertToPixels(this.height),t.style.display="block",t.style.position="absolute",t.style.zIndex=(this.layerZIndexCount++).toString(),this.root.appendChild(t),this.layers[e]?(this.layers[e].context=t.getContext("2d"),this.redrawAllEntitiesOnLayer(e)):this.layers[e]={context:t.getContext("2d"),entities:new Set},t}add(e){let t="";switch(e.type){case"custom":case"score":t="overlay";break;case"tank":t="tanks";break;case"projectile":t="projectiles";break;case"trees":case"indicator":t="ceiling";break;case"explosion":t="explosions";break;default:t="floor";break}this.bindEntityToLayer(e,t)}bindEntityToLayer(e,t){var a;const o={instance:e,listeners:{[h.ShouldUpdate]:()=>{!e.spawned||this.eraseFromLayer(e,t)},[h.DidUpdate]:()=>{this.drawOnLayer(e,t)},[h.ShouldRenderText]:()=>{this.drawTextOnLayer(e,t)},[h.ShouldBeDestroyed]:()=>{this.eraseFromLayer(e,t),this.removeEntityFromLayer(e,t)},[h.Destroyed]:n=>{(e.type==="brickWall"||e.type==="concreteWall")&&this.eraseFromLayer(n,t)}}};(a=this.layers[t])==null||a.entities.add(o);for(const[n,l]of Object.entries(o.listeners))e.on(n,l)}removeEntityFromLayer(e,t){let o=null;for(const a of this.layers[t].entities)a.instance===e&&(o=a);if(o){this.layers[t].entities.delete(o);for(const[a,n]of Object.entries(o.listeners))e.off(a,n)}}drawTextOnLayer(e,t){const o=this.layers[t].context;if(o.font=`${this.convertToPixels(e.height)-1}px "Press Start 2P"`,o.textAlign=e.align,o.textBaseline="top",e.backImg){const n=o.createPattern(e.backImg,"repeat");n!==null&&(o.fillStyle=n)}else o.fillStyle=e.color;let a=e.posX;e.align==="center"&&(a+=Math.round(e.width/2)),e.align==="right"&&(a+=e.width),o.fillText(e.text,this.convertToPixels(a),this.convertToPixels(e.posY)+1)}drawOnLayer(e,t){var a;const o=this.layers[t].context;if(!e.mainSpriteCoordinates||!this.isSpriteImgLoaded()){e.color&&(o.fillStyle=e.color,o.fillRect(...this.getActualRect(e)));return}if(e.backColor||e.backImg){if(e.backColor&&(o.fillStyle=e.backColor),e.backImg){const n=o.createPattern(e.backImg,"repeat");n!==null&&(o.fillStyle=n)}o.fillRect(...this.getActualRect(e))}if(!((a=e.animationList)!=null&&a.length)){this.drawMainEntitySprite(e,o);return}e.animationList.length&&e.animationList.forEach(n=>{const l=this.getSpriteCoordinates({entity:e,animation:n});!l||this.spriteImg===null||(n.showMainSprite&&this.drawMainEntitySprite(e,o),o.drawImage(this.spriteImg,l[0],l[1],l[2],l[3],...this.getActualRect(e)),this.setNextSpriteFrame(n,e))})}drawMainEntitySprite(e,t){const o=this.getSpriteCoordinates({entity:e});!o||this.spriteImg===null||t.drawImage(this.spriteImg,o[0],o[1],o[2],o[3],...this.getActualRect(e))}eraseFromLayer(e,t){this.layers[t].context.clearRect(...this.getActualRect(e))}redrawAllEntitiesOnLayer(e){if(!this.layers[e])return;const{entities:t}=this.layers[e];this.eraseAllEntitiesOnLayer(e);for(const o of t)this.drawOnLayer(o.instance,e)}eraseAllEntitiesOnLayer(e){if(!this.layers[e])return;const{context:t}=this.layers[e];t.clearRect(0,0,this.convertToPixels(this.width),this.convertToPixels(this.height)),this.layers[e].entities.clear()}getActualRect(e){let t=0,o=0;return"type"in e&&e.type==="tank"&&(t=2,o=-4),[this.convertToPixels(e.posX,t),this.convertToPixels(e.posY,t),this.convertToPixels(e.width,o),this.convertToPixels(e.height,o)]}getSpriteCoordinates({entity:e,animation:t}){let o=null;if(!t&&e.mainSpriteCoordinates){if(!e.movable&&Array.isArray(e.mainSpriteCoordinates))return e.mainSpriteCoordinates[0];if(e.movable&&!Array.isArray(e.mainSpriteCoordinates))return e instanceof _&&!e.moving||(e.mainSpriteFrame=+!e.mainSpriteFrame),e.mainSpriteCoordinates[e.direction][e.mainSpriteFrame]}if(t&&Array.isArray(t.spriteCoordinates))return o=t.spriteCoordinates[t.spriteFrame||0],o}setNextSpriteFrame(e,t){var l;const o=performance.now();e.lastTime||(e.lastTime=o);const a=o-e.lastTime;if(typeof e.spriteFrame!="number"||a<e.delay)return;e.lastTime=o,e.spriteFrame++;const n=e.spriteFrame===((l=e.spriteCoordinates)==null?void 0:l.length);n&&e.looped&&(e.spriteFrame=0),n&&!e.looped&&e.name&&t.cancelAnimation("eraseEntity",e.name)}isRootEmpty(){return this.root.innerHTML.trim()===""}convertToPixels(e,t=0){return Math.round(e*this.pixelRatio+t)}getPixelRatio(){let t=window.innerWidth/this.width,o=t*this.height>window.innerHeight;for(;o;)t-=.5,o=t*this.height>window.innerHeight;return Math.floor(t/.5)*.5}canvasResizeHandler(){if(!(this.root.firstChild instanceof HTMLCanvasElement)||!this.root.firstChild.width)return;const e=this.root.firstChild.width,o=this.width*this.getPixelRatio()/e;this.root.style.transform="scale("+o*100+"%)"}isSpriteImgLoaded(){return this.spriteImg instanceof HTMLImageElement&&this.spriteImg.complete&&this.spriteImg.width>0&&this.spriteImg.height>0}changeGameTheme(){const e=this.game.state;this.setNextGameTheme(),localStorage.setItem(ve,e.themeName),this.spriteImg=this.game.resources.getImage(H[e.themeName].spriteName),this.floorLayer.style.background=H[e.themeName].floorBg,ct(e.themeName)}setNextGameTheme(){const e=Object.values(G),t=e.indexOf(this.game.state.themeName),o=t===e.length-1?0:t+1;this.game.state.themeName=e[o]}}var Ke=(i=>(i[i.Main=0]="Main",i[i.Secondary=1]="Secondary",i[i.Projectiles=2]="Projectiles",i[i.Powerups=3]="Powerups",i))(Ke||{});class Yt{constructor(s){r(this,"width",0);r(this,"height",0);r(this,"matrix");this.game=s;const{width:e,height:t}=s.state;this.width=e,this.height=t,this.matrix=[];for(const o of Object.values(Ke))if(typeof o=="number"){this.matrix[o]=Array(this.width);for(let a=0;a<this.matrix[o].length;++a)this.matrix[o][a]=Array(this.height).fill(null)}}getLayerByEntityType(s){switch(s.type){case"ice":case"trees":return 1;case"projectile":return 2;case"powerup":return 3;default:return 0}}reset(){for(let s=0;s<this.matrix.length;++s)this.updateMatrix(s,{posX:0,posY:0,width:this.width,height:this.height},null)}add(s){this.registerEntity(s)}updateMatrix(s,e,t){if(!(this.isBeyondMatrix(e)||!this.isLegalRect(e)))for(let o=e.posX+e.width-1;o>=e.posX;--o)for(let a=e.posY+e.height-1;a>=e.posY;--a)this.matrix[s][o][a]=t}writeEntityToMatrix(s){if(s.alignedToGrid){const e=this.getLayerByEntityType(s),t=s.getRect();this.updateMatrix(e,t,s)}}deleteEntityFromMatrix(s){const e=this.getLayerByEntityType(s);if(s instanceof fe){let t=s.lastRect;t?this.updateMatrix(e,t,null):(t=s.getRect(),this.updateMatrix(e,t,null)),s.nextRect&&(t=s.nextRect,this.updateMatrix(e,t,null))}else{const t=s.getRect();this.updateMatrix(e,t,null)}}registerEntity(s){s.type==="score"||s.type==="explosion"||(s.on(h.WillHaveNewPos,e=>{const t=e.nextRect;if(this.hasCollision(t,s))e.hasCollision=!0;else{const o=this.getLayerByEntityType(s);this.updateMatrix(o,t,s),s instanceof _&&s.sliding&&(s.sliding=this.shouldSlide(t))}}),s.on(h.ShouldUpdate,e=>{!e||!("posX"in e)||!("posY"in e)||!s.spawned||this.deleteEntityFromMatrix(s)}),s.on(h.DidUpdate,e=>{!e||!("posX"in e)||!("posY"in e)||this.writeEntityToMatrix(s)}),s.on(h.ShouldBeDestroyed,()=>{this.deleteEntityFromMatrix(s)}),s.on(h.WillDoDamage,e=>{s instanceof V&&this.doAreaDamage(e,s)}),s instanceof _&&s.on(h.Stop,()=>{s.slide(this.shouldSlide(s.nextRect||s.lastRect||s.getRect()))}),(s.type==="brickWall"||s.type==="concreteWall")&&s.on(h.Destroyed,e=>{const t=this.getLayerByEntityType(s);this.updateMatrix(t,e,null)}))}isLegalRect(s){return s.posX%1===0&&s.posY%1===0&&s.width%1===0&&s.height%1===0}isBeyondMatrix(s){return!!(this.isBeyondXAxis(s)||this.isBeyondYAxis(s))}isBeyondXAxis(s){const e=s.posX+s.width;return s.posX<0||e>this.width}isBeyondYAxis(s){const e=s.posY+s.height;return s.posY<0||e>this.height}doAreaDamage(s,e){var t,o;for(let a=s.posX+s.width-1;a>=s.posX;--a)for(let n=s.posY+s.height-1;n>=s.posY;--n){const l=(t=this.matrix[0][a])==null?void 0:t[n],m=(o=this.matrix[2][a])==null?void 0:o[n],y={posX:a,posY:n,width:1,height:1};l&&l.hittable&&(!(e instanceof V)||l!==e.parent)&&(l.type!=="tank"||this.currentRectsOverlap(e,l))&&l.takeDamage(e,y),m&&m.takeDamage(e,y)}}shouldSlide(s){var e;for(let t=s.posX+s.width-1;t>=s.posX;--t)for(let o=s.posY+s.height-1;o>=s.posY;--o){const a=(e=this.matrix[1][t])==null?void 0:e[o];if(!a||a.type!=="ice")return!1}return!0}hasCollisionsWithMatrix(s,e){var t,o,a;for(let n=s.posX+s.width-1;n>=s.posX;--n)for(let l=s.posY+s.height-1;l>=s.posY;--l){const m=(t=this.matrix[0][n])==null?void 0:t[l],y=(o=this.matrix[2][n])==null?void 0:o[l],f=(a=this.matrix[3][n])==null?void 0:a[l];if(!(!m&&!y&&!f)){if(e instanceof _){if(m!==null&&m!==e&&!m.crossable)return!0;if(f!==null&&e instanceof Z){const w={posX:n,posY:l,width:1,height:1};f.takeDamage(e,w)}}if(e instanceof V){if(m!==null&&m.hittable&&m!==e.parent){if(e.role==="enemy"&&e.role===m.role)continue;if(m.type==="tank")if(this.currentRectsOverlap(e,m)){const w={posX:n,posY:l,width:1,height:1};return e.explode(),m.takeDamage(e,w),!0}else continue;return!0}if(y!==null&&y!==e){if(e.role==="enemy"&&e.role===y.role)continue;return!0}}}}return!1}currentRectsOverlap(s,e,t=.25){const o=s.posX+t,a=s.posX+s.width-t,n=s.posY+t,l=s.posY+s.height-t,m=e.posX+t,y=e.posX+e.width-t,f=e.posY+t,w=e.posY+e.height-t,I=o>=y,M=a<=m,P=n>=w,J=l<=f;return!(I||M||P||J)}hasCollision(s,e){return!!(this.isBeyondMatrix(s)||this.hasCollisionsWithMatrix(s,e))}}const Nt=i=>typeof i.hidden<"u"?"visibilitychange":typeof i.msHidden<"u"?"msvisibilitychange":typeof i.webkitHidden<"u"?"webkitvisibilitychange":"visibilitychange",Gt=i=>{if(typeof i.hidden<"u")return"hidden";if(typeof i.msHidden<"u")return"msHidden";if(typeof i.webkitHidden<"u")return"webkitHidden"},Xt=i=>{const s=Gt(i);return s&&!i[s]};function Wt(){const i=typeof document>"u"?()=>!0:()=>Xt(document),[s,e]=k.exports.useState(i()),t=()=>e(i());return k.exports.useEffect(()=>{const o=Nt(document);return document.addEventListener(o,t,!1),()=>{document.removeEventListener(o,t)}}),s}const Ut=()=>B("svg",{viewBox:"1 1 22 22",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g("path",{d:"M10 15V9"}),g("path",{d:"M14 15V9"}),g("path",{d:"M7.714 2h8.572L22 7.714v8.572L16.286 22H7.714L2 16.286V7.714L7.714 2z"})]}),Ht=()=>B("svg",{viewBox:"0 0 36 36",strokeWidth:"0",children:[g("path",{d:"M24.87,6.69A12.42,12.42,0,0,1,28.75,26.3l1.42,1.42A14.43,14.43,0,0,0,25.74,4.88a1,1,0,0,0-.87,1.8Z"}),g("path",{d:"M27.3,27.67h0l-3.84-3.84-.57-.57h0L4.63,5,3.21,6.41,8.8,12H3a1,1,0,0,0-1,1V23a1,1,0,0,0,1,1H8.83l9.51,8.3A1,1,0,0,0,20,31.55V23.2l5.59,5.59c-.17.1-.34.2-.51.29a1,1,0,0,0,.9,1.79c.37-.19.72-.4,1.08-.62l2.14,2.14L30.61,31l-3.25-3.25Z"}),g("path",{d:"M22.69,12.62A6.27,6.27,0,0,1,25.8,18a6.17,6.17,0,0,1-1.42,3.92l1.42,1.42a8.16,8.16,0,0,0,2-5.34,8.28,8.28,0,0,0-4.1-7.11,1,1,0,1,0-1,1.73Z"}),g("path",{d:"M20,4.62a1,1,0,0,0-1.66-.75l-6.42,5.6L20,17.54Z"})]}),jt=()=>B("svg",{viewBox:"0 0 512 512",children:[g("path",{d:"M0,0v512h512V0H0z M477.867,477.867H34.133V34.133h443.733V477.867z"}),g("polygon",{points:"126.533,102.4 199.111,102.4 199.111,68.267 68.267,68.267 68.267,199.111 102.4,199.111 102.4,126.538     198.422,222.558 222.556,198.423   "}),g("polygon",{points:"222.557,313.581 198.422,289.445 102.4,385.467 102.4,312.889 68.267,312.889 68.267,443.733 199.111,443.733     199.111,409.6 126.538,409.6   "}),g("polygon",{points:"409.6,312.889 409.6,385.467 313.578,289.444 289.444,313.578 385.462,409.6 312.889,409.6 312.889,443.733     443.733,443.733 443.733,312.889   "}),g("polygon",{points:"312.889,68.267 312.889,102.4 385.467,102.4 289.444,198.423 313.578,222.558 409.6,126.538 409.6,199.111     443.733,199.111 443.733,68.267   "})]}),zt=()=>g("svg",{viewBox:"0 0 611.999 611.999",children:g("path",{d:"M216.02,611.195c5.978,3.178,12.284-3.704,8.624-9.4c-19.866-30.919-38.678-82.947-8.706-149.952   c49.982-111.737,80.396-169.609,80.396-169.609s16.177,67.536,60.029,127.585c42.205,57.793,65.306,130.478,28.064,191.029   c-3.495,5.683,2.668,12.388,8.607,9.349c46.1-23.582,97.806-70.885,103.64-165.017c2.151-28.764-1.075-69.034-17.206-119.851   c-20.741-64.406-46.239-94.459-60.992-107.365c-4.413-3.861-11.276-0.439-10.914,5.413c4.299,69.494-21.845,87.129-36.726,47.386   c-5.943-15.874-9.409-43.33-9.409-76.766c0-55.665-16.15-112.967-51.755-159.531c-9.259-12.109-20.093-23.424-32.523-33.073   c-4.5-3.494-11.023,0.018-10.611,5.7c2.734,37.736,0.257,145.885-94.624,275.089c-86.029,119.851-52.693,211.896-40.864,236.826   C153.666,566.767,185.212,594.814,216.02,611.195z"})}),Ae=()=>{const{game:i,isGameInited:s}=k.exports.useContext(Te),[e,t]=k.exports.useState(!1),[o,a]=k.exports.useState(!1),[n,l]=k.exports.useState(!1),[m,y]=k.exports.useState(!1);k.exports.useEffect(()=>{!s||(i.view.on(O.ToggleColorServiceBtn,M=>{M===N.Pause?a(P=>!P):M===N.Mute?l(P=>!P):M===N.Fullscreen&&y(P=>!P)}),i.on(O.ToggleVisibilityServiceBtn,()=>{t(M=>!M)}))},[s]);const f=pe(`${v.DefaultServiceBtn} ${v.PauseBtn}`,{[v.ActivatedServiceBtn]:o}),w=pe(`${v.DefaultServiceBtn} ${v.MuteBtn}`,{[v.ActivatedServiceBtn]:n}),I=pe(`${v.DefaultServiceBtn} ${v.FullscreenBtn}`,{[v.ActivatedServiceBtn]:m});return B("div",{className:"controller",children:[B("div",{className:"controller__service","data-testid":"controller__service",children:[e?B(Ze,{children:[g("div",{className:f,children:g(Ut,{})}),g("div",{className:w,children:g(Ht,{})})]}):null,/iPad|iPhone/.test(navigator.userAgent)?null:g("div",{className:I,children:g(jt,{})})]}),g("div",{className:"controller__shoot","data-testid":"controller__shoot",children:g("button",{className:v.ShootBtn,children:g(zt,{})})})]})};var Ve={},le={};const Kt=Qe(et);var Q={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.JoystickShape=void 0,function(s){s.Circle="circle",s.Square="square"}(i.JoystickShape||(i.JoystickShape={}))})(Q);var he={};Object.defineProperty(he,"__esModule",{value:!0});he.shapeFactory=void 0;var Ce=Q,Vt=function(i,s){switch(i){case Ce.JoystickShape.Circle:return{borderRadius:s};case Ce.JoystickShape.Square:return{borderRadius:Math.sqrt(s)}}};he.shapeFactory=Vt;var ce={};Object.defineProperty(ce,"__esModule",{value:!0});ce.shapeBoundsFactory=void 0;var Jt=Q,$t=function(i,s,e,t,o,a,n,l,m){switch(i){case Jt.JoystickShape.Square:return t=Oe(s-m.left-l/2,l),o=Oe(e-m.top-l/2,l),{relativeX:t,relativeY:o};default:return a>n&&(t*=n/a,o*=n/a),{relativeX:t,relativeY:o}}};ce.shapeBoundsFactory=$t;var Oe=function(i,s){var e=s/2;return i>e?e:i<-e?e*-1:i},_e=Kt.jsx,qt=ie&&ie.__extends||function(){var i=function(s,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a])},i(s,e)};return function(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(s,e);function t(){this.constructor=s}s.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),z=ie&&ie.__assign||function(){return z=Object.assign||function(i){for(var s,e=1,t=arguments.length;e<t;e++){s=arguments[e];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(i[o]=s[o])}return i},z.apply(this,arguments)};Object.defineProperty(le,"__esModule",{value:!0});le.Joystick=void 0;var me=k.exports,Fe=Q,Ye=he,Zt=ce,C;(function(i){i.PointerDown="pointerdown",i.PointerMove="pointermove",i.PointerUp="pointerup"})(C||(C={}));var F;(function(i){i[i.TopRight=2.35619449]="TopRight",i[i.TopLeft=-2.35619449]="TopLeft",i[i.BottomRight=.785398163]="BottomRight",i[i.BottomLeft=-.785398163]="BottomLeft"})(F||(F={}));var Qt=function(i){qt(s,i);function s(e){var t=i.call(this,e)||this;return t._stickRef=me.createRef(),t._baseRef=me.createRef(),t._pointerId=null,t.state={dragging:!1},t._throttleMoveCallback=function(){var o=0;return function(a){var n=new Date().getTime(),l=t.props.throttle||0;if(!(n-o<l)&&(o=n,t.props.move))return t.props.move(a)}}(),t}return s.prototype.componentWillUnmount=function(){var e=this;this.props.followCursor&&window.removeEventListener(C.PointerMove,function(t){return e._pointerMove(t)})},s.prototype.componentDidMount=function(){var e=this;this.props.followCursor&&(this._parentRect=this._baseRef.current.getBoundingClientRect(),this.setState({dragging:!0}),window.addEventListener(C.PointerMove,function(t){return e._pointerMove(t)}),this.props.start&&this.props.start({type:"start",x:null,y:null,distance:null,direction:null}))},s.prototype._updatePos=function(e){var t=this;window.requestAnimationFrame(function(){t.setState({coordinates:e})}),!(typeof this.props.minDistance=="number"&&e.distance<this.props.minDistance)&&this._throttleMoveCallback({type:"move",x:e.relativeX*2/this._baseSize,y:-(e.relativeY*2/this._baseSize),direction:e.direction,distance:e.distance})},s.prototype._pointerDown=function(e){var t=this;this.props.disabled||this.props.followCursor||(this._parentRect=this._baseRef.current.getBoundingClientRect(),this.setState({dragging:!0}),window.addEventListener(C.PointerUp,function(o){return t._pointerUp(o)}),window.addEventListener(C.PointerMove,function(o){return t._pointerMove(o)}),this._pointerId=e.pointerId,this._stickRef.current.setPointerCapture(e.pointerId),this.props.start&&this.props.start({type:"start",x:null,y:null,distance:null,direction:null}))},s.prototype._getDirection=function(e){return e>F.TopRight||e<F.TopLeft?"FORWARD":e<F.TopRight&&e>F.BottomRight?"RIGHT":e<F.BottomLeft?"LEFT":"BACKWARD"},s.prototype._distance=function(e,t){return Math.hypot(e,t)},s.prototype._distanceToPercentile=function(e){var t=e/(this._baseSize/2)*100;return t>100?100:t},s.prototype._pointerMove=function(e){if(e.preventDefault(),this.state.dragging){if(!this.props.followCursor&&e.pointerId!==this._pointerId)return;var t=e.clientX,o=e.clientY,a=t-this._parentRect.left-this._radius,n=o-this._parentRect.top-this._radius,l=this._distance(a,n),m=(0,Zt.shapeBoundsFactory)(this.props.controlPlaneShape||this.props.baseShape,t,o,a,n,l,this._radius,this._baseSize,this._parentRect);a=m.relativeX,n=m.relativeY;var y=Math.atan2(a,n);this._updatePos({relativeX:a,relativeY:n,distance:this._distanceToPercentile(l),direction:this._getDirection(y),axisX:t-this._parentRect.left,axisY:o-this._parentRect.top})}},s.prototype._pointerUp=function(e){var t=this;if(e.pointerId===this._pointerId){var o={dragging:!1};this.props.sticky||(o.coordinates=void 0),window.requestAnimationFrame(function(){t.setState(o)}),window.removeEventListener(C.PointerUp,function(a){return t._pointerUp(a)}),window.removeEventListener(C.PointerMove,function(a){return t._pointerMove(a)}),this._pointerId=null,this.props.stop&&this.props.stop({type:"stop",x:this.props.sticky?this.state.coordinates.relativeX*2/this._baseSize:null,y:this.props.sticky?this.state.coordinates.relativeY*2/this._baseSize:null,direction:this.props.sticky?this.state.coordinates.direction:null,distance:this.props.sticky?this.state.coordinates.distance:null})}},s.prototype.getBaseShapeStyle=function(){var e=this.props.baseShape||Fe.JoystickShape.Circle;return(0,Ye.shapeFactory)(e,this._baseSize)},s.prototype.getStickShapeStyle=function(){var e=this.props.stickShape||Fe.JoystickShape.Circle;return(0,Ye.shapeFactory)(e,this._baseSize)},s.prototype._getBaseStyle=function(){var e=this.props.baseColor!==void 0?this.props.baseColor:"#000033",t="".concat(this._baseSize,"px"),o=z(z({},this.getBaseShapeStyle()),{height:t,width:t,background:e,display:"flex",justifyContent:"center",alignItems:"center"});return this.props.baseImage&&(o.background="url(".concat(this.props.baseImage,")"),o.backgroundSize="100%"),o},s.prototype._getStickStyle=function(){var e=this.props.stickColor!==void 0?this.props.stickColor:"#3D59AB",t=this._stickSize?"".concat(this._stickSize,"px"):"".concat(this._baseSize/1.5,"px"),o=z(z({},this.getStickShapeStyle()),{background:e,cursor:"move",height:t,width:t,border:"none",flexShrink:0,touchAction:"none"});return this.props.stickImage&&(o.background="url(".concat(this.props.stickImage,")"),o.backgroundSize="100%"),this.state.coordinates!==void 0&&(o=Object.assign({},o,{position:"absolute",transform:"translate3d(".concat(this.state.coordinates.relativeX,"px, ").concat(this.state.coordinates.relativeY,"px, 0)")})),o},s.prototype.render=function(){var e=this;this._baseSize=this.props.size||100,this._stickSize=this.props.stickSize,this._radius=this._baseSize/2;var t=this._getBaseStyle(),o=this._getStickStyle();return _e("div",{className:this.props.disabled?"joystick-base-disabled":"",ref:this._baseRef,style:t,children:_e("button",{ref:this._stickRef,disabled:this.props.disabled,onPointerDown:function(a){return e._pointerDown(a)},className:this.props.disabled?"joystick-disabled":"",style:o})})},s}(me.Component);le.Joystick=Qt;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.JoystickShape=i.Joystick=void 0;var s=le;Object.defineProperty(i,"Joystick",{enumerable:!0,get:function(){return s.Joystick}});var e=Q;Object.defineProperty(i,"JoystickShape",{enumerable:!0,get:function(){return e.JoystickShape}})})(Ve);function es(i){return typeof i=="string"?Object.values(Ee).includes(i):!1}const ts=()=>{const{game:i}=k.exports.useContext(Te);let s=null;const e=(o,a)=>{!(o.direction&&o.direction!==s)||es(o.direction)&&(s=o.direction,a.controllerAll.startControlByEvent(o.direction))},t=o=>{s&&o.controllerAll.stopControlByEvent(s),o.controllerAll.stopControlForce&&Object.values(Ee).forEach(a=>{o.controllerAll.stopControlByEvent(a)}),s=null};return g("div",{className:"stick","data-testid":"stick",children:g(Ve.Joystick,{size:160,baseColor:u.Black,stickColor:u.White,minDistance:40,throttle:40,move:o=>e(o,i),stop:()=>t(i)})})};const ss=()=>B("div",{className:"joystick","data-testid":"joystick",children:[g("div",{className:"joystick__up joystick__vertical-buttons",children:g("button",{className:`joystick__button ${v.MoveUpBtn}`,children:g("span",{className:`${v.MoveUpBtn}_arrow`,children:"\u25B2"})})}),B("div",{className:"joystick__row",children:[g("div",{className:"joystick__left joystick__horizontal-buttons",children:g("button",{className:`joystick__button ${v.MoveLeftBtn}`,children:g("div",{className:`${v.MoveLeftBtn}_arrow`,children:"\u25B2"})})}),g("div",{className:"joystick__center","data-testid":"joystick__center"}),g("div",{className:"joystick__right joystick__horizontal-buttons",children:g("button",{className:`joystick__button ${v.MoveRightBtn}`,children:g("span",{className:`${v.MoveRightBtn}_arrow`,children:"\u25B2"})})})]}),g("div",{className:"joystick__bottom joystick__vertical-buttons",children:g("button",{className:`joystick__button ${v.MoveDownBtn}`,children:g("span",{className:`${v.MoveDownBtn}_arrow`,children:"\u25B2"})})})]}),Te=k.exports.createContext({}),rs=()=>{var m;const i=tt(),s=k.exports.useRef(null),e=Wt(),t=se.create();t.state.username=((m=st(it.userProfile))==null?void 0:m.login)||"";const[o,a]=k.exports.useState(t.state.inited),[n,l]=k.exports.useState(localStorage.getItem(ae));return k.exports.useEffect(()=>{var y;return t.init(s.current),a(t.state.inited),t.on(we.UpdateLeaderboard,f=>{i(ot.addScore(f))}),t.controllerAll.on(c.ToggleJoystickType,()=>{setTimeout(()=>{l(localStorage.getItem(ae))},100)}),(y=document.querySelector(".layout"))==null||y.classList.add("layout__game"),Ne({isScalable:!1}),()=>{var f;t.unload(),(f=document.querySelector(".layout"))==null||f.classList.remove("layout__game"),Ne({isScalable:!0})}},[]),k.exports.useEffect(()=>{e===!1&&!t.state.paused&&t.state.screen===S.GameStart&&t.togglePause()},[e]),g(Te.Provider,{value:{game:t,isGameInited:o},children:B("div",{className:v.FullscreenWrapper,children:[rt({title:"\u0418\u0433\u0440\u0430 \u0422\u0430\u043D\u0447\u0438\u043A\u0438, Battle City 1990 \u043D\u0430 Dendy"}),g("div",{ref:s,className:"game__root"}),b()?B("div",{className:"pointer-controller",children:[n===ne.Stick?g(ts,{}):g(ss,{}),g(Ae,{})]}):g("div",{className:"desktop-controller",children:g(Ae,{})})]})})};function Ne({isScalable:i}){const s=i?"":", maximum-scale=1, user-scalable=no",e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute("content",`width=device-width, initial-scale=1.0${s}`)}export{rs as Game};
